<!DOCTYPE chapter>
<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:id="security" xml:lang="ru">
    <info>
        <title>Безопасность</title>
    </info>

    <para>Базы данных, как и данные, хранимые в файлах базы данных, должны быть защищены. Firebird
        обеспечивает двухуровневую защиту данных — аутентификация пользователя на уровне сервера и
        привилегии на уровне базы данных. В данной главе рассказывается, каким образом управлять
        безопасностью вашей базы данных на каждом из уровней.</para>

    <section xml:id="security-auth">
        <title>Аутентификация пользователя</title>

        <para>Безопасность всей базы данных зависит от проверки подлинности идентификатора
            пользователя. Подлинность пользователя может выполняться несколькими способами в
            зависимости от установок параметра <parameter>AuthServer</parameter> в файле
            конфигурации <filename>firebird.conf</filename>. Этот параметр содержит список доступных
            плагинов проверки подлинности. Если проверить подлинность с помощью первого плагина не
            удалось, то сервер переходит к следующему плагину и т.д. Если ни один плагин не
            подтвердил подлинность, то пользователь получает сообщение об ошибке.</para>
        <para>Информация о пользователях, зарегистрированных для конкретного сервера Firebird,
            хранится в особой базе данных безопасности (security database) —
                <filename>security4.fdb</filename>. Для каждой базы данных база данных безопасности
            может переопределена в файле <filename>databases.conf</filename> (параметр
                <parameter>SecurityDatabase</parameter>). Любая база данных может быть базой данных
            безопасности для самой себя. </para>
        <para>Имя пользователя может состоять максимум из 63 символов. Максимальная длина пароля
            зависит от плагина проверки подлинности и плагина управления пользователями (параметр
                <parameter>UserManager</parameter>), регистр — учитывается. По умолчанию будет
            выбран первый плагин из списка плагинов управления пользователями. Этот плагин можно
            изменить в SQL командах управления пользователями. Для плагина SRP эффективная длина
            пароля ограничена 20 байтами *. Для плагина Legacy_UserManager максимальная длина пароля
            равна 8 байт. </para>
        <note>
            <title>*Почему эффективная длина пароля ограничена 20 символами?</title>
            <para> На длину пароля нет ограничения в 20 байт и он может быть использован. Хэши
                различных паролей, длина которых более 20 байт, тоже различны. Предел эффективности
                наступает из-за ограниченной длины хэша в SHA1 равном 20 байт или 160 бит. Рано или
                поздно найдётся более короткий пароль с тем же хэшем с помощью атаки Brute Force.
                Именно поэтому часто говорят, что эффективная длина пароля для алгоритма SHA1
                составляет 20 байт. </para>
        </note>
        <para>Встроенная версия сервера (embedded), не использует аутентификацию. Тем не менее, имя
            пользователя, и если необходимо роль, должны быть указаны в параметрах подключения,
            поскольку они используются для контроля доступа к объектам базы данных.</para>
        <para>Пользователь SYSDBA или пользователь вошедший с ролью RDB$ADMIN, получают
            неограниченный доступ к базе данных. Если пользователь является владельцем базы данных,
            то без указания роли RDB$ADMIN он получает неограниченный доступ ко всем объектам
            принадлежащим этой базе данных.</para>

        <section xml:id="security-auth-special">
            <title>Специальные учётные записи</title>

            <section xml:id="security-auth-special-sysdba">
                <info>
                    <title>SYSDBA</title>
                    <keywordset>
                        <keyword>SYSDBA</keyword>
                    </keywordset>
                </info>

                <indexterm><primary>SYSDBA</primary></indexterm>

                <para>В Firebird существует специальная учётная запись SYSDBA, которая существует
                    вне всех ограничений безопасности и имеет полный доступ ко всем базам данных
                    сервера. </para>
            </section>

            <section xml:id="security-auth-special-posix">
                <title>Особенности POSIX</title>

                <para>В POSIX системах, включая MacOSX, имя пользователя POSIX будет
                    интерпретировано как имя пользователя Firebird Embedded, если имя пользователя
                    не указано явно. </para>

                <section xml:id="security-auth-sysdba-posix">
                    <title>Пользователь <database class="user">SYSDBA</database> в POSIX</title>

                    <para>В POSIX системах, кроме MacOSX, пользователь <database class="user"
                            >SYSDBA</database> не имеет пароля по умолчанию. Если полная установка
                        установка осуществляется с помощью стандартных скриптов, то одноразовый
                        пароль будет создан и сохранён в текстовом файле в том же каталоге что и
                            <filename>security4.fdb</filename>, обычно это
                            <filename>/opt/firebird/</filename>. Файл с паролём имеет имя
                            <filename>SYSDBA.password</filename>.</para>

                    <note>
                        <para>При выполнении установки с помощью определённого распространяемого
                            установщика, расположение файла базы данных безопасности и файла с
                            паролем может отличаться от стандартного.</para>
                    </note>
                </section>
                <section xml:id="security-auth-root-posix">
                    <title>Пользователь <emphasis>root</emphasis> в POSIX</title>

                    <para>В POSIX системах пользователь <emphasis>root</emphasis> может выступать в
                        роли <database class="user">SYSDBA</database>. Firebird Embedded в этом
                        случае будет трактовать имя пользователя <emphasis>root</emphasis> как
                            <database class="user">SYSDBA</database>, и вы будете иметь доступ ко
                        всем базам данных сервера.</para>
                </section>
            </section>
            <section xml:id="security-auth-special-windows">
                <title>Особенности Windows</title>

                <para>В операционных системах семейства Windows NT вы также можете пользоваться
                    учётными записями ОС. Для этого необходимо, чтобы в файле конфигурации
                        <filename>firebird.conf</filename> (параметр
                        <parameter>AuthServer</parameter>) в списке плагинов присутствовал провайдер
                    Win_Sspi. Кроме того, этот плагин должен присутствовать и в списке плагинов
                    клиентской стороны (параметр <parameter>AuthClient</parameter>).</para>
                <para>Администраторы операционной системы Windows автоматически не получают права
                    SYSDBA при подключении к базе данных (если, конечно, разрешена доверенная
                    авторизация). Имеют ли администраторы автоматические права SYSDBA, зависит от
                    установки значения флага AUTO ADMIN MAPPING.</para>
                <note>
                    <para>До Firebird 3.0 при включенной доверительной аутентификации, пользователи
                        прошедшие проверку по умолчанию автоматически отображались в CURRENT_USER. В
                        Firebird 3 и выше отображение должно быть сделано явно для систем с
                        несколькими базами данных безопасности и включенной доверительной
                        аутентификацией. См. <link linkend="security-mapping-create">CREATE
                            MAPPING</link>.</para>
                </note>
            </section>
            <section xml:id="security-auth-special-dbowner">
                <title>Владелец базы данных</title>

                <para>Владелец базы данных — это либо текущий пользователь
                        (<database>CURRENT_USER</database>), который был момент создания, либо
                    пользователь который был указан в параметрах USER и PASSWORD в операторе CREATE
                    DATABASE.</para>
                <para>Владелец базы данных является администратором в ней и имеет полный доступ ко
                    всем объектам этой базы данных, даже созданных другими пользователями.</para>
            </section>
        </section>

        <section xml:id="security-administrators">
            <info>
                <title>Администраторы</title>
            </info>

            <para>Администратор — это пользователь, которые имеет достаточные права для чтения и
                записи, создания, изменения и удаления любого объекта в базе данных. В таблице
                показано, как привилегии <quote>Суперпользователя</quote> включены в различных
                контекстах безопасности Firebird.</para>

            <para>
                <table xml:id="security-tbl-administrators" frame="all">
                    <?dbfo keep-together='auto'?>
                    <title>Администраторы</title>
                    <tgroup cols="3">
                        <colspec colname="colUser" colnum="1" colwidth="1.2*"/>
                        <colspec colname="colAdmin" colnum="2" colwidth="1.2*"/>
                        <colspec colname="colComment" colnum="3" colwidth="3*"/>
                        <spanspec spanname="all" namest="colUser" nameend="colComment"/>
                        <thead>
                            <row>
                                <entry>Пользователь</entry>
                                <entry>Роль RDB$ADMIN</entry>
                                <entry>Замечание</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>SYSDBA</entry>
                                <entry>Автоматически</entry>
                                <entry>Существует автоматически на уровне сервера. Имеет полные
                                    привилегии ко всем объектам во всех базах данных. Может
                                    создавать. изменять и удалять пользователей, но не имеет прямого
                                    доступа к базе данных безопасности.</entry>
                            </row>
                            <row>
                                <entry>Пользователь <emphasis>root</emphasis> в POSIX</entry>
                                <entry>Автоматически</entry>
                                <entry>Также как <database class="user">SYSDBA</database>. Только в
                                    Firebird Embedded.</entry>
                            </row>
                            <row>
                                <entry>Суперпользователь в POSIX</entry>
                                <entry>Автоматически</entry>
                                <entry>Также как <database class="user">SYSDBA</database>. Только в
                                    Firebird Embedded.</entry>
                            </row>
                            <row>
                                <entry>Владелец базы данных</entry>
                                <entry>Автоматически</entry>
                                <entry>Также как <database class="user">SYSDBA</database>, но только
                                    в этой базе данных.</entry>
                            </row>
                            <row>
                                <entry>Администраторы Windows</entry>
                                <entry>Устанавливается в CURRENT_ROLE, если вход успешен</entry>
                                <entry><para>Также как <database class="user">SYSDBA</database>,
                                        если соблюдены следующие условия:<itemizedlist>
                                            <listitem>
                                                <para>В файле конфигурации
                                                  <filename>firebird.conf</filename> (параметр
                                                  <parameter>AuthServer</parameter>) в списке
                                                  плагинов присутствовал провайдер Win_Sspi. Кроме
                                                  того, этот плагин должен присутствовать и в списке
                                                  плагинов клиентской стороны (параметр
                                                  <parameter>AuthClient</parameter>).</para>
                                            </listitem>
                                            <listitem>
                                                <para>Во всех базах данных, где требуется полномочия
                                                  суперпользователя должен быть включен AUTO ADMIN
                                                  MAPPING или создано отображение предопределенной
                                                  группы DOMAIN_ANY_RID_ADMINS на роль
                                                  RDB$ADMIN.</para>
                                            </listitem>
                                            <listitem>
                                                <para>При входе не указана роль.</para>
                                            </listitem>
                                        </itemizedlist></para></entry>
                            </row>
                            <row>
                                <entry>Обычный пользователь</entry>
                                <entry>Должна быть предварительно выдана и должна быть указана при
                                    входе</entry>
                                <entry>Также как <database class="user">SYSDBA</database>, но только
                                    в тех базах данных, где эта роль предоставлена.</entry>
                            </row>
                            <row>
                                <entry>Пользователь POSIX</entry>
                                <entry>Должна быть предварительно выдана и должна быть указана при
                                    входе</entry>
                                <entry>Также как <database class="user">SYSDBA</database>, но только
                                    в тех базах данных, где эта роль предоставлена. Только в
                                    Firebird Embedded.</entry>
                            </row>
                            <row>
                                <entry>Пользователь Windows</entry>
                                <entry>Должна быть предварительно выдана и должна быть указана при
                                    входе</entry>
                                <entry>Также как <database class="user">SYSDBA</database>, но только
                                    в тех базах данных, где эта роль предоставлена. Доступно только
                                    если в файле конфигурации <filename>firebird.conf</filename>
                                    (параметр <parameter>AuthServer</parameter>) в списке плагинов
                                    присутствовал провайдер Win_Sspi. Кроме того, этот плагин должен
                                    присутствовать и в списке плагинов клиентской стороны (параметр
                                        <parameter>AuthClient</parameter>).</entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>
        </section>

        <section xml:id="security-mapping">
            <info>
                <title>Отображение объектов безопасности</title>
            </info>
            <para>С введением поддержки множества баз данных безопасности в Firebird появились новые
                проблемы, которые не могли произойти с единой глобальной базой данных безопасности.
                Кластеры баз данных, использующие одну и ту же базу данных безопасности, были
                эффективно разделены. Отображения предоставляют средства для достижения той же
                эффективности, когда существует множество баз данных, использующих свои собственные
                базу данных безопасности. В некоторых случаях требуется управление для ограничения
                взаимодействия между такими кластерами. Например: <itemizedlist>
                    <listitem>
                        <para>когда EXECUTE STATEMENT ON EXTERNAL DATA SOURCE требует обмена данными
                            между кластерами;</para>
                    </listitem>
                    <listitem>
                        <para>когда обще серверный SYSDBA доступ к базам данных необходим от других
                            кластеров, использующих службы;</para>
                    </listitem>
                    <listitem>
                        <para>аналогичные проблемы существовали в Firebird 2.1 и 2.5 под Windows,
                            из-за поддержки доверительной аутентификации: существовало два отдельных
                            списка пользователей — один в базе данных безопасности, а другой в
                            Windows, в тех случаях когда было необходимо связать их. Примером может
                            служить получение роли, предоставленной группе Windows, автоматически
                            назначаемой членам этой группы.</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>Единым решением для всех этих случаев является создание правил отображения
                информации о пользователе, входящего в систему, на внутренние объекты безопасности —
                CURRENT_USER и CURRENT_ROLE.</para>
            <note>
                <para>В Firebird имеется одно встроенное глобальное правило, действующее по
                    умолчанию: пользователи прошедшие проверку в базе данных безопасности всегда
                    отображается в любую базу данных один к одному. Это безопасное правило: для базы
                    данных безопасности не имеет смысла не доверять себе.</para>
            </note>
            <section xml:id="security-mapping-create">
                <info>
                    <title>CREATE MAPPING</title>
                    <keywordset>
                        <keyword>CREATE MAPPING</keyword>
                    </keywordset>
                </info>
                <indexterm><primary>CREATE MAPPING</primary></indexterm>
                <formalpara>
                    <title>Назначение:</title>

                    <para>Создание отображения объекта безопасности.</para>
                </formalpara>

                <formalpara>
                    <title>Доступно в:</title>

                    <para>DSQL.</para>
                </formalpara>
                <formalpara>
                    <title>Синтаксис:</title>

                    <para><programlisting>
CREATE [GLOBAL] MAPPING <replaceable>name</replaceable>
USING {
    PLUGIN <replaceable>plugin_name</replaceable> [IN <replaceable>database</replaceable>] 
  | ANY PLUGIN [IN <replaceable>database</replaceable> | SERVERWIDE] 
  | MAPPING [IN <replaceable>database</replaceable>] 
  | '*' [IN <replaceable>database</replaceable>] }
FROM { ANY <replaceable>type</replaceable> | <replaceable>type</replaceable> <replaceable>from_name</replaceable> }
TO { USER | ROLE } [<replaceable>to_name</replaceable>]
                       </programlisting></para>
                </formalpara>
                <para>
                    <table frame="all">
                        <title>Параметры оператора CREATE MAPPING</title>
                        <?dbfo keep-together='auto'?>
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                            <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                            <thead>
                                <row>
                                    <entry align="center">Параметр</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry><replaceable>name</replaceable></entry>
                                    <entry>
                                        <para>Имя отображения. Может содержать до 63
                                            символов.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>plugin_name</replaceable></entry>
                                    <entry>
                                        <para>Имя плагина аутентификации.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>database</replaceable></entry>
                                    <entry>
                                        <para>Имя базы данных, в которой прошла
                                            аутентификация.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>type</replaceable></entry>
                                    <entry>
                                        <para>Тип объекта, который будет отображён.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>from_name</replaceable></entry>
                                    <entry>
                                        <para>Имя объекта, который будет отображён.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>to_name</replaceable></entry>
                                    <entry>
                                        <para>Имя объекта (пользователи или роли) на которое будет
                                            произведено отображение.</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <para>Оператор CREATE MAPPING создаёт отображение объектов безопасности
                    (пользователей, групп, ролей) одного или нескольких плагинов аутентификации на
                    внутренние объекты безопасности – CURRENT_USER и CURRENT_ROLE. Имя отображения
                    должно быть уникальным среди имён отображений.</para>
                <indexterm>
                    <primary>CREATE MAPPING</primary>
                    <secondary>GLOBAL</secondary>
                </indexterm>
                <para>Если присутствует опция GLOBAL, то отображение будет применено не только для
                    текущей базы данных, но и для всех баз данных находящимся в том же кластере, в
                    том числе и базы данных безопасности.</para>
                <important>
                    <para>Если существуют одноименные глобальные и локальные отображение, то вам
                        следует знать, что это разные объекты.</para>
                </important>
                <note>
                    <para> Глобальное отображение работает, если в качестве базы данных безопасности
                        используется база данных Firebird 3 или более высокой версии. Если вы
                        планируете использовать другую базу данных, например, для целей
                        использования собственного поставщика, то вам необходимо создать таблицу в
                        ней и назвать её RDB$MAP с той же структурой, что и RDB$MAP в базе данных
                        Firebird 3 и дать доступ на запись только для <database class="user"
                            >SYSDBA</database>. </para>
                </note>
                <indexterm>
                    <primary>CREATE MAPPING</primary>
                    <secondary>USING</secondary>
                </indexterm>
                <para>Предложение USING описывает источник отображения. Оно имеет весьма сложный
                    набор опций: <itemizedlist spacing="compact">
                        <listitem>
                            <para>явное указание имени плагина (опция PLUGIN) означает, что оно
                                будет работать только с этим плагином;</para>
                        </listitem>
                        <listitem>
                            <para>оно может использовать любой доступный плагин (опция ANY PLUGIN),
                                даже если источник является продуктом предыдущего
                                отображения;</para>
                        </listitem>
                        <listitem>
                            <para>оно может быть сделано так, чтобы работать только с обще
                                серверными плагинами (опция SERVERWIDE);</para>
                        </listitem>
                        <listitem>
                            <para>оно может быть сделано так, чтобы работать только с результатами
                                предыдущего отображения (опция MAPPING);</para>
                        </listitem>
                        <listitem>
                            <para>вы можете опустить использование любого из методов, используя
                                звёздочку (*) в качестве аргумента;</para>
                        </listitem>
                        <listitem>
                            <para>оно может содержать имя базы данных (опция IN), из которой
                                происходит отображение объекта FROM. <note>
                                    <para>Этот аргумент не является допустимым для отображения с
                                        обще серверной аутентификацией.</para>
                                </note>
                            </para>
                        </listitem>
                    </itemizedlist></para>
                <indexterm>
                    <primary>CREATE MAPPING</primary>
                    <secondary>FROM</secondary>
                </indexterm>
                <para>Предложение FROM описывает отображаемый объект. Оно принимает обязательный
                    аргумент — тип объекта. Особенности:<itemizedlist spacing="compact">
                        <listitem>
                            <para>при отображении имён из плагинов, тип определяется
                                плагином;</para>
                        </listitem>
                        <listitem>
                            <para>при отображении продукта предыдущего отображения, типом может быть
                                только USER и ROLE;</para>
                        </listitem>
                        <listitem>
                            <para>если имя объекта будет указано явно, то оно будет учитываться при
                                отображении;</para>
                        </listitem>
                        <listitem>
                            <para>при использовании ключевого слова ANY будут отображены объекты с
                                любыми именами данного типа.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <indexterm>
                    <primary>CREATE MAPPING</primary>
                    <secondary>TO</secondary>
                </indexterm>
                <para>В предложении TO указывается пользователь или роль, на которого будет
                    произведено отображение. NAME является не обязательным аргументом. Если он не
                    указан, то в качестве имени объекта будет использовано оригинальное имя из
                    отображаемого объекта.</para>
                <para>
                    <itemizedlist>
                        <title>Создать отображение могут:</title>
                        <listitem>
                            <para>SYSDBA;</para>
                        </listitem>
                        <listitem>
                            <para>Владелец базы данных (если отображение локальное);</para>
                        </listitem>
                        <listitem>
                            <para>Любой пользователь, вошедший с ролью RDB$ADMIN;</para>
                        </listitem>
                        <listitem>
                            <para>Пользователь root операционной системы Linux.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Включение использования доверительной аутентификации Windows во
                                всех базах данных, которые используют текущую базу данных
                                безопасности.</title>
                            <para>
                                <programlisting language="sql">
CREATE GLOBAL MAPPING TRUSTED_AUTH
USING PLUGIN WIN_SSPI
FROM ANY USER
TO USER;                        
                    </programlisting>
                            </para>
                        </example>
                        <example>
                            <title>Включение SYSDBA подобного доступа для администраторов Windows в
                                текущей базе данных.</title>
                            <para>
                                <programlisting language="sql">
CREATE MAPPING WIN_ADMINS
USING PLUGIN WIN_SSPI
FROM Predefined_Group
DOMAIN_ANY_RID_ADMINS
TO ROLE RDB$ADMIN;                       
                    </programlisting>
                            </para>
                        </example>
                        <note>
                            <para> Группа DOMAIN_ANY_RID_ADMINS не существует в Windows, но такое
                                имя будет добавлено плагином win_sspi для обеспечения точной
                                обратной совместимости. </para>
                        </note>
                        <example>
                            <title>Включение доступа определённому пользователю из другой базы
                                данных к текущей базе данных под другим именем.</title>
                            <para>
                                <programlisting language="sql">
CREATE MAPPING FROM_RT
USING PLUGIN SRP IN "rt"
FROM USER U1 TO USER U2;                      
                    </programlisting>
                            </para>
                        </example>
                        <important>
                            <para>Имена баз данных должны быть заключены в двойные кавычки на
                                операционных системах, которые имею регистр чувствительные имена
                                файлов.</para>
                        </important>
                        <example>
                            <title>Включение обще серверного SYSDBA (от основной базы данных
                                безопасности) для доступа к текущей базе данных.</title>
                            <para>Предположим, что база данных использует базу данных безопасности
                                не по умолчанию.
                                <programlisting language="sql">
CREATE MAPPING DEF_SYSDBA
USING PLUGIN SRP IN "security.db"
FROM USER SYSDBA
TO USER;                     
                    </programlisting>
                            </para>
                        </example>
                        <example>
                            <title>Создание ограничения прав для пользователей, которые подключаются
                                унаследованным плагином аутентификации.</title>
                            <para>
                                <programlisting language="sql">
CREATE MAPPING LEGACY_2_GUEST
USING PLUGIN legacy_auth
FROM ANY USER
TO USER GUEST;                    
                    </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>
                <formalpara>
                    <title>См. также:</title>

                    <para>
                        <link linkend="security-mapping-alter">ALTER MAPPING</link>, <link
                            linkend="security-mapping-createoralter">CREATE OR ALTER MAPPING</link>,
                            <link linkend="security-mapping-drop">DROP MAPPING</link>. </para>
                </formalpara>
            </section>
            <section xml:id="security-mapping-alter">
                <info>
                    <title>ALTER MAPPING</title>
                    <keywordset>
                        <keyword>ALTER MAPPING</keyword>
                    </keywordset>
                </info>
                <indexterm><primary>ALTER MAPPING</primary></indexterm>
                <formalpara>
                    <title>Назначение:</title>

                    <para>Изменение отображения объекта безопасности.</para>
                </formalpara>

                <formalpara>
                    <title>Доступно в:</title>

                    <para>DSQL.</para>
                </formalpara>
                <formalpara>
                    <title>Синтаксис:</title>

                    <para><programlisting>
ALTER [GLOBAL] MAPPING <replaceable>name</replaceable>
USING {
    PLUGIN <replaceable>plugin_name</replaceable> [IN <replaceable>database</replaceable>] 
  | ANY PLUGIN [IN <replaceable>database</replaceable> | SERVERWIDE] 
  | MAPPING [IN <replaceable>database</replaceable>] 
  | '*' [IN <replaceable>database</replaceable>] }
FROM { ANY <replaceable>type</replaceable> | <replaceable>type</replaceable> <replaceable>from_name</replaceable> }
TO { USER | ROLE } [<replaceable>to_name</replaceable>]
                       </programlisting></para>
                </formalpara>
                <para>
                    <table frame="all">
                        <title>Параметры оператора ALTER MAPPING</title>
                        <?dbfo keep-together='auto'?>
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                            <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                            <thead>
                                <row>
                                    <entry align="center">Параметр</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry><replaceable>name</replaceable></entry>
                                    <entry>
                                        <para>Имя отображения.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>plugin_name</replaceable></entry>
                                    <entry>
                                        <para>Имя плагина аутентификации.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>database</replaceable></entry>
                                    <entry>
                                        <para>Имя базы данных, в которой прошла
                                            аутентификация.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>type</replaceable></entry>
                                    <entry>
                                        <para>Тип объекта, который будет отображён.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>from_name</replaceable></entry>
                                    <entry>
                                        <para>Имя объекта, который будет отображён.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>to_name</replaceable></entry>
                                    <entry>
                                        <para>Имя объекта (пользователи или роли) на которое будет
                                            произведено отображение.</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <para>Оператор ALTER MAPPING позволяет изменять любые опции существующего
                    отображения.</para>
                <important>
                    <para>Одноименные глобальные и локальные отображение — это разные
                        объекты.</para>
                </important>
                <para>
                    <itemizedlist>
                        <title>Изменить отображение могут:</title>
                        <listitem>
                            <para><database class="user">SYSDBA</database>;</para>
                        </listitem>
                        <listitem>
                            <para>Владелец базы данных (если отображение локальное);</para>
                        </listitem>
                        <listitem>
                            <para>Любой пользователь, вошедший с ролью RDB$ADMIN;</para>
                        </listitem>
                        <listitem>
                            <para>Пользователь root операционной системы Linux.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Изменение отображения.</title>
                            <para>
                                <programlisting language="sql">
ALTER MAPPING FROM_RT
USING PLUGIN SRP IN "rt"
FROM USER U1 TO USER U3;                      
                    </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>

                <formalpara>
                    <title>См. также:</title>

                    <para>
                        <link linkend="security-mapping-create">CREATE MAPPING</link>, <link
                            linkend="security-mapping-createoralter">CREATE OR ALTER MAPPING</link>,
                            <link linkend="security-mapping-drop">DROP MAPPING</link>. </para>
                </formalpara>
            </section>
            <section xml:id="security-mapping-createoralter">
                <info>
                    <title>CREATE OR ALTER MAPPING</title>
                    <keywordset>
                        <keyword>CREATE OR ALTER MAPPING</keyword>
                    </keywordset>
                </info>
                <indexterm><primary>CREATE OR ALTER MAPPING</primary></indexterm>
                <formalpara>
                    <title>Назначение:</title>

                    <para>Создание или изменение отображения объекта безопасности.</para>
                </formalpara>

                <formalpara>
                    <title>Доступно в:</title>

                    <para>DSQL.</para>
                </formalpara>
                <formalpara>
                    <title>Синтаксис:</title>

                    <para><programlisting>
CREATE OR ALTER [GLOBAL] MAPPING <replaceable>name</replaceable>
USING {
    PLUGIN <replaceable>plugin_name</replaceable> [IN <replaceable>database</replaceable>] 
  | ANY PLUGIN [IN <replaceable>database</replaceable> | SERVERWIDE] 
  | MAPPING [IN <replaceable>database</replaceable>] 
  | '*' [IN <replaceable>database</replaceable>] }
FROM { ANY <replaceable>type</replaceable> | <replaceable>type</replaceable> <replaceable>from_name</replaceable> }
TO { USER | ROLE } [<replaceable>to_name</replaceable>]
                       </programlisting></para>
                </formalpara>
                <para>
                    <table frame="all">
                        <title>Параметры оператора CREATE OR ALTER MAPPING</title>
                        <?dbfo keep-together='auto'?>
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                            <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                            <thead>
                                <row>
                                    <entry align="center">Параметр</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry><replaceable>name</replaceable></entry>
                                    <entry>
                                        <para>Имя отображения. Может содержать до 63
                                            символов.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>plugin_name</replaceable></entry>
                                    <entry>
                                        <para>Имя плагина аутентификации.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>database</replaceable></entry>
                                    <entry>
                                        <para>Имя базы данных, в которой прошла
                                            аутентификация.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>type</replaceable></entry>
                                    <entry>
                                        <para>Тип объекта, который будет отображён.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>from_name</replaceable></entry>
                                    <entry>
                                        <para>Имя объекта, который будет отображён.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>to_name</replaceable></entry>
                                    <entry>
                                        <para>Имя объекта (пользователи или роли) на которое будет
                                            произведено отображение.</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <para>Оператор CREATE OR ALTER MAPPING создаёт новое или изменяет существующее
                    отображение. Если отображение не существует, то оно будет создано с
                    использованием предложения CREATE MAPPING.</para>
                <important>
                    <para>Одноименные глобальные и локальные отображение — это разные
                        объекты.</para>
                </important>

                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Создание нового или изменение существующего отображения.</title>
                            <para>
                                <programlisting language="sql">
CREATE OR ALTER MAPPING FROM_RT
USING PLUGIN SRP IN "rt"
FROM USER U1 TO USER U4;                      
                    </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>

                <formalpara>
                    <title>См. также:</title>

                    <para>
                        <link linkend="security-mapping-create">CREATE MAPPING</link>, <link
                            linkend="security-mapping-alter">ALTER MAPPING</link>, <link
                            linkend="security-mapping-drop">DROP MAPPING</link>. </para>
                </formalpara>
            </section>
            <section xml:id="security-mapping-drop">
                <info>
                    <title>DROP MAPPING</title>
                    <keywordset>
                        <keyword>DROP MAPPING</keyword>
                    </keywordset>
                </info>
                <indexterm><primary>DROP MAPPING</primary></indexterm>
                <formalpara>
                    <title>Назначение:</title>

                    <para>Удаление отображения объекта безопасности.</para>
                </formalpara>
                <formalpara>
                    <title>Доступно в:</title>

                    <para>DSQL.</para>
                </formalpara>
                <formalpara>
                    <info>
                        <title>Синтаксис:</title>
                    </info>

                    <para><programlisting>
DROP [GLOBAL] MAPPING <replaceable>name</replaceable>
                       </programlisting></para>
                </formalpara>
                <para>
                    <table frame="all">
                        <title>Параметры оператора DROP MAPPING</title>
                        <?dbfo keep-together='auto'?>
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                            <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                            <thead>
                                <row>
                                    <entry align="center">Параметр</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry><replaceable>name</replaceable></entry>
                                    <entry>
                                        <para>Имя отображения.</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <para>Оператор DROP MAPPING удаляет существующее отображение. Если указана опция
                    GLOBAL, то будет удалено глобальное отображение.</para>
                <important>
                    <para>Одноименные глобальные и локальные отображение — это разные
                        объекты.</para>
                </important>
                <para>
                    <itemizedlist>
                        <title>Удалить отображение могут:</title>
                        <listitem>
                            <para>SYSDBA;</para>
                        </listitem>
                        <listitem>
                            <para>Владелец базы данных (если отображение локальное);</para>
                        </listitem>
                        <listitem>
                            <para>Любой пользователь, вошедший с ролью RDB$ADMIN;</para>
                        </listitem>
                        <listitem>
                            <para>Пользователь root операционной системы Linux.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <formalpara>
                    <title>Примеры:</title>
                    <para>
                        <example>
                            <title>Удаление отображения.</title>
                            <para>
                                <programlisting language="sql">
DROP MAPPING FROM_RT;                      
                    </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>
                <formalpara>
                    <title>См. также:</title>

                    <para>
                        <link linkend="security-mapping-create">CREATE MAPPING</link>. </para>
                </formalpara>
            </section>
        </section>

    </section>

    <section xml:id="security-user">
        <info>
            <title>Управление пользователями</title>
        </info>
        <para>В данном разделе описываются операторы создания, модификации и удаления учётных
            записей пользователей Firebird средствами операторов SQL. Такая возможность
            предоставлена следующим пользователям: <itemizedlist>
                <listitem>
                    <para>SYSDBA;</para>
                </listitem>
                <listitem>
                    <para>Любому пользователю, имеющему права на роль RDB$ADMIN в базе данных
                        пользователей и права на ту же роль для базы данных в активном подключении
                        (пользователь должен подключаться к базе данных с ролью RDB$ADMIN);</para>
                </listitem>
                <listitem>
                    <para>При включенном флаге AUTO ADMIN MAPPING в базе данных пользователей
                            (<filename>security4.fdb</filename> или той, что установлена для вашей
                        базы данных в файле <filename>databases.conf</filename>) — любой
                        администратор операционной системы Windows (при условии использования
                        сервером доверенной авторизации — trusted authentication) без указания роли.
                        При этом не важно, включен или выключен флаг AUTO ADMIN MAPPING в самой базе
                        данных. </para>
                </listitem>
            </itemizedlist>
        </para>
        <para>Непривилегированные пользователи могут использовать только оператор ALTER USER для
            изменения собственной учётной записи. </para>
        <section xml:id="security-user-create">
            <info>
                <title>CREATE USER</title>
                <keywordset>
                    <keyword>CREATE USER</keyword>
                </keywordset>
            </info>
            <indexterm><primary>CREATE USER</primary></indexterm>
            <formalpara>
                <title>Назначение:</title>

                <para>Создание учётной записи пользователя Firebird.</para>
            </formalpara>
            <formalpara>
                <title>Доступно в:</title>

                <para>DSQL.</para>
            </formalpara>
            <formalpara>
                <title>Синтаксис:</title>


                <para><programlisting>
CREATE USER <replaceable>username</replaceable> PASSWORD '<replaceable>password</replaceable>'
  [FIRSTNAME '<replaceable>firstname</replaceable>']
  [MIDDLENAME '<replaceable>middlename</replaceable>']
  [LASTNAME '<replaceable>lastname</replaceable>']
  [ACTIVE | INACTIVE]
  [USING PLUGIN <replaceable>pluginname</replaceable>] 
  [TAGS (<replaceable>&lt;tag&gt;</replaceable> [, <replaceable>&lt;tag&gt;</replaceable> [, <replaceable>&lt;tag&gt;</replaceable> ...]] )]
  [GRANT ADMIN ROLE];

<replaceable>&lt;tag&gt;</replaceable> ::= <replaceable>tagname</replaceable> = '<replaceable>string value</replaceable>'                    
                </programlisting></para>
            </formalpara>
            <para>
                <table frame="all">
                    <title>Параметры оператора CREATE USER</title>
                    <?dbfo keep-together='auto'?>
                    <tgroup cols="2">
                        <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                        <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                        <thead>
                            <row>
                                <entry align="center">Параметр</entry>
                                <entry align="center">Описание</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry><replaceable>username</replaceable></entry>
                                <entry>
                                    <para>Имя пользователя. Максимальная длина 63 символов.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>password</replaceable></entry>
                                <entry>
                                    <para>Пароль пользователя. Чувствительно к регистру.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>firstname</replaceable></entry>
                                <entry>
                                    <para>Вспомогательная информация: имя пользователя. Максимальная
                                        длина 32 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>middlename</replaceable></entry>
                                <entry>
                                    <para>Вспомогательная информация: &quot;второе имя&quot;
                                        (отчество, &quot;имя отца&quot;) пользователя. Максимальная
                                        длина 32 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>lastname</replaceable></entry>
                                <entry>
                                    <para>Вспомогательная информация: фамилия пользователя.
                                        Максимальная длина 32 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>pluginname</replaceable></entry>
                                <entry>
                                    <para>Имя плагина управления пользователями, в котором
                                        необходимо создать нового пользователя.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>tagname</replaceable></entry>
                                <entry>
                                    <para>Имя пользовательского атрибута. Максимальная длина 63
                                        символа. Имя атрибута должно подчиняться правилам
                                        наименования SQL идентификаторов.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>string value</replaceable></entry>
                                <entry>
                                    <para>Значение пользовательского атрибута. Максимальная длина
                                        255 символов.</para>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>

            <para>Оператор CREATE USER создаёт учётную запись пользователя Firebird. Пользователь
                должен отсутствовать в текущей базе данных безопасности Firebird иначе будет выдано
                соответствующее сообщение об ошибке.</para>
            <important>
                <para>Начиная с Firebird 3.0 имена пользователей подчиняются общему правилу
                    наименования идентификаторов объектов метаданных. Таким образом, пользователь с
                    именем "Alex" и с именем "ALEX" будут разными пользователями.
                    <programlisting language="sql"> 
CREATE USER ALEX PASSWORD 'bz23ds';

-- этот пользователь такой же как и первый
CREATE USER Alex PASSWORD 'bz23ds';

-- этот пользователь такой же как и первый
CREATE USER "ALEX" PASSWORD 'bz23ds';

-- а это уже другой пользователь
CREATE USER "Alex" PASSWORD 'bz23ds';
                </programlisting>
                </para>
            </important>
            <indexterm>
                <primary>CREATE USER</primary>
                <secondary>PASSWORD</secondary>
            </indexterm>
            <para>Предложение PASSWORD задаёт пароль пользователя. Максимальная длина пароля зависит
                от того какой менеджер пользователей задействован (параметр
                    <parameter>UserManager</parameter>). Для менеджер пользователей SRP эффективная
                длина пароля ограничена 20 байтами *. Для менеджер пользователей Legacy_UserManager
                максимальная длина пароля равна 8 байт. </para>
            <note>
                <title>*Почему эффективная длина пароля ограничена 20 символами?</title>
                <para> На длину пароля нет ограничения в 20 байт и он может быть использован. Хэши
                    различных паролей, длина которых более 20 байт, тоже различны. Предел
                    эффективности наступает из-за ограниченной длины хэша в SHA1 равном 20 байт или
                    160 бит. Рано или поздно найдётся более короткий пароль с тем же хэшем с помощью
                    атаки Brute Force. Именно поэтому часто говорят, что эффективная длина пароля
                    для алгоритма SHA1 составляет 20 байт. </para>
            </note>
            <indexterm>
                <primary>CREATE USER</primary>
                <secondary>FIRSTNAME</secondary>
            </indexterm>
            <indexterm>
                <primary>CREATE USER</primary>
                <secondary>MIDDLENAME</secondary>
            </indexterm>
            <indexterm>
                <primary>CREATE USER</primary>
                <secondary>LASTNAME</secondary>
            </indexterm>
            <para>Необязательные предложения FIRSTNAME, MIDDLENAME и LASTNAME задают дополнительные
                атрибуты пользователя, такие как имя пользователя (имя человека), отчество и фамилия
                соответственно.</para>
            <indexterm>
                <primary>CREATE USER</primary>
                <secondary>TAGS</secondary>
            </indexterm>
            <para>Кроме того вы можете задать неограниченное количество пользовательских атрибутов с
                помощью необязательного предложения TAGS. Данная возможность доступна только при
                использовании Srp в качестве менеджера пользователей.</para>
            <indexterm>
                <primary>CREATE USER</primary>
                <secondary>INACTIVE</secondary>
            </indexterm>
            <indexterm>
                <primary>CREATE USER</primary>
                <secondary>ACTIVE</secondary>
            </indexterm>
            <para>Если при создании учётной записи будет указан атрибут INACTIVE, то пользователь
                будет создан в &quot;неактивном состоянии&quot;, т.е. подключиться с его учётной
                записью будет невозможно. При указании атрибута ACTIVE пользователь будет создан в
                активном состоянии. По умолчанию пользователь создаётся активным. Данная возможность
                доступна только при использовании Srp в качестве менеджера пользователей.</para>
            <indexterm>
                <primary>CREATE USER</primary>
                <secondary>GRANT ADMIN ROLE</secondary>
            </indexterm>
            <para>Если указана опция GRANT ADMIN ROLE, то новая учётная запись пользователя
                создаётся с правами роли RDB$ADMIN в текущей базе данных безопасности. Это позволяет
                вновь созданному пользователю управлять учётными записями пользователей, но не даёт
                ему специальных полномочий в обычных базах данных.</para>
            <indexterm>
                <primary>CREATE USER</primary>
                <secondary>USING PLUGIN</secondary>
            </indexterm>
            <para>Необязательное предложение USING PLUGIN позволяет явно указывать какой плагин
                управления пользователями будет использован. По умолчанию используется тот плагин,
                который был указан первым в списке параметра <parameter>UserManager</parameter> в
                файле конфигурации <filename>firebird.conf</filename>. Допустимыми являются только
                значения, перечисленные в параметре <parameter>UserManager</parameter>.</para>
            <important>
                <title>Важно:</title>
                <para>Учтите что одноименные пользователи, созданные с помощью разных плагинов
                    управления пользователями — это разные пользователи. Поэтому пользователя
                    созданного с помощью одного плагина управления пользователями можно удалить или
                    изменить, указав только тот же самый плагин. </para>
            </important>
            <para>Для создания учётной записи пользователя текущий пользователь должен обладать
                административными привилегиями.</para>

            <formalpara>
                <title>Примеры:</title>
                <para>
                    <example>
                        <title>Создание пользователя.</title>

                        <para><programlisting language="sql"> 
CREATE USER bigshot PASSWORD 'buckshot';
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Создание пользователя с помощью плагина управления пользователями
                            Legacy_UserManager.</title>

                        <para><programlisting language="sql"> 
CREATE USER godzilla PASSWORD 'robot'
USING PLUGIN Legacy_UserManager;
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Создание пользователя с пользовательскими атрибутами.</title>

                        <para><programlisting language="sql"> 
CREATE USER john PASSWORD 'fYe_3Ksw'
FIRSTNAME 'John'
LASTNAME 'Doe'
TAGS (BIRTHYEAR = '1970', CITY = 'New York');
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Создание пользователя в неактивном состоянии.</title>

                        <para><programlisting language="sql"> 
CREATE USER john PASSWORD 'fYe_3Ksw'
FIRSTNAME 'John'
LASTNAME 'Doe'
INACTIVE;
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Создание пользователя с возможностью управления
                            пользователями.</title>

                        <para><programlisting language="sql"> 
CREATE USER superuser PASSWORD 'kMn8Kjh'
GRANT ADMIN ROLE;
                </programlisting>
                        </para>
                    </example>
                </para>
            </formalpara>

            <formalpara>
                <title>См. также:</title>

                <para>
                    <link linkend="security-user-alter">ALTER USER</link>, <link
                        linkend="security-user-createoralter">CREATE OR ALTER USER</link>, <link
                        linkend="security-user-drop">DROP USER</link>. </para>
            </formalpara>
        </section>
        <section xml:id="security-user-alter">
            <info>
                <title>ALTER USER</title>
                <keywordset>
                    <keyword>ALTER USER</keyword>
                </keywordset>
            </info>
            <indexterm><primary>ALTER USER</primary></indexterm>
            <formalpara>
                <title>Назначение:</title>

                <para>Изменение учётной записи пользователя Firebird.</para>
            </formalpara>

            <formalpara>
                <title>Доступно в:</title>


                <para>DSQL.</para>
            </formalpara>
            <formalpara>
                <title>Синтаксис:</title>

                <para><programlisting>
ALTER {USER <replaceable>username</replaceable> | CURRENT USER}
{ 
  [SET]
  [PASSWORD '<replaceable>password</replaceable>']
  [FIRSTNAME '<replaceable>firstname</replaceable>']
  [MIDDLENAME '<replaceable>middlename</replaceable>']
  [LASTNAME '<replaceable>lastname</replaceable>']
  [ACTIVE | INACTIVE]
  [TAGS (<replaceable>&lt;tag&gt;</replaceable> | DROP <replaceable>tagname</replaceable> [, <replaceable>&lt;tag&gt;</replaceable> | DROP <replaceable>tagname</replaceable> ...] )]
}
[USING PLUGIN <replaceable>pluginname</replaceable>] 
[{GRANT | REVOKE} ADMIN ROLE];
  
<replaceable>&lt;tag&gt;</replaceable> ::= <replaceable>tagname</replaceable> = '<replaceable>string value</replaceable>'                    
                </programlisting></para>
            </formalpara>
            <para>
                <table frame="all">
                    <title>Параметры оператора ALTER USER</title>
                    <?dbfo keep-together='auto'?>
                    <tgroup cols="2">
                        <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                        <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                        <thead>
                            <row>
                                <entry align="center">Параметр</entry>
                                <entry align="center">Описание</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry><replaceable>username</replaceable></entry>
                                <entry>
                                    <para>Имя пользователя.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>password</replaceable></entry>
                                <entry>
                                    <para>Пароль пользователя. Чувствительно к регистру.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>firstname</replaceable></entry>
                                <entry>
                                    <para>Вспомогательная информация: имя пользователя. Максимальная
                                        длина 32 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>middlename</replaceable></entry>
                                <entry>
                                    <para>Вспомогательная информация: &quot;второе имя&quot;
                                        (отчество, &quot;имя отца&quot;) пользователя. Максимальная
                                        длина 32 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>lastname</replaceable></entry>
                                <entry>
                                    <para>Вспомогательная информация: фамилия пользователя.
                                        Максимальная длина 32 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>pluginname</replaceable></entry>
                                <entry>
                                    <para>Имя плагина управления пользователями, в котором был
                                        создан данный пользователь.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>tagname</replaceable></entry>
                                <entry>
                                    <para>Имя пользовательского атрибута. Максимальная длина 63
                                        символа. Имя атрибута должно подчиняться правилам
                                        наименования SQL идентификаторов.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>string value</replaceable></entry>
                                <entry>
                                    <para>Значение пользовательского атрибута. Максимальная длина
                                        255 символов.</para>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>

            <para>Оператор ALTER USER изменяет данные учётной записи пользователя. В операторе ALTER
                USER должен присутствовать хотя бы одно из необязательных предложений.</para>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>PASSWORD</secondary>
            </indexterm>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>FIRSTNAME</secondary>
            </indexterm>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>MIDDLENAME</secondary>
            </indexterm>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>LASTNAME</secondary>
            </indexterm>
            <para>Необязательное предложение PASSWORD задаёт новый пароль пользователя.
                Необязательные предложения FIRSTNAME, MIDDLENAME и LASTNAME позволяют изменить
                дополнительные атрибуты пользователя, такие как имя пользователя (имя человека),
                отчество и фамилия соответственно.</para>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>INACTIVE</secondary>
            </indexterm>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>ACTIVE</secondary>
            </indexterm>
            <para>Атрибут INACTIVE позволяет сделать учётную запись неактивной. Это удобно когда
                необходимо временно отключить учётную запись без её удаления. Атрибут ACTIVE
                позволяет вернуть неактивную учётную запись в активное состояние. Данная возможность
                доступна только при использовании Srp в качестве менеджера пользователей.</para>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>TAGS</secondary>
            </indexterm>
            <para>Необязательное предложение TAGS позволяет задать, изменить или удалить
                пользовательские атрибуты. Если в списке атрибутов, атрибута с заданным именем не
                было, то он будет добавлен, иначе его значение будет изменено. Атрибуты не указанные
                в списке не будут изменены. Для удаления пользовательского атрибута перед его именем
                в списке атрибутов необходимо указать ключевое слово DROP. Данная возможность
                доступна только при использовании Srp в качестве менеджера пользователей.</para>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>GRANT ADMIN ROLE</secondary>
            </indexterm>
            <para>Предложение GRANT ADMIN ROLE предоставляет указанному пользователю привилегии роли
                RDB$ADMIN в текущей базе данных безопасности. Это позволяет указанному пользователю
                управлять учётными записями пользователей, но не даёт ему специальных полномочий в
                обычных базах данных.</para>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>REVOKE ADMIN ROLE</secondary>
            </indexterm>
            <para>Предложение REVOKE ADMIN ROLE отбирает у указанного пользователя привилегии роли
                RDB$ADMIN в текущей базе данных безопасности. Это запрещает указанному пользователю
                управлять учётными записями пользователей.</para>
            <indexterm>
                <primary>ALTER USER</primary>
                <secondary>USING PLUGIN</secondary>
            </indexterm>
            <para>Необязательное предложение USING PLUGIN позволяет явно указывать какой плагин
                управления пользователями будет использован. По умолчанию используется тот плагин,
                который был указан первым в списке параметра <parameter>UserManager</parameter> в
                файле конфигурации <filename>firebird.conf</filename>. Допустимыми являются только
                значения, перечисленные в параметре <parameter>UserManager</parameter>.</para>
            <important>
                <title>Важно:</title>
                <para> Учтите что одноименные пользователи, созданные с помощью разных плагинов
                    управления пользователями — это разные пользователи. Поэтому пользователя
                    созданного с помощью одного плагина управления пользователями можно удалить или
                    изменить, указав только тот же самый плагин. </para>
            </important>
            <para>Если требуется изменить свою учётную запись, то вместо указания имени текущего
                пользователя можно использовать предложение CURRENT USER.</para>
            <para>Для модификации чужой учётной записи пользователя текущий пользователь должен
                обладать административными привилегиями. Свои собственные учётные записи могут
                изменять любые пользователи, однако это не относится к опциям GRANT/REVOKE ADMIN
                ROLE и атрибуту ACTIVE/INACTIVE для изменения которых необходимы административные
                привилегии.</para>

            <formalpara>
                <title>Примеры:</title>
                <para>
                    <example>
                        <title>Изменение пользователя и выдача ему привилегии управления
                            пользователями.</title>

                        <para><programlisting language="sql"> 
ALTER USER bobby PASSWORD '67-UiT_G8'
GRANT ADMIN ROLE;
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Изменение пароля пользователя, созданного с помощью плагина
                            управления пользователями Legacy_UserManager.</title>

                        <para><programlisting language="sql"> 
ALTER USER godzilla PASSWORD 'robot12'
USING PLUGIN Legacy_UserManager;
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Изменение дополнительных атрибутов своей учётной записи.</title>

                        <para><programlisting language="sql"> 
ALTER CURRENT USER
FIRSTNAME 'No_Jack'
LASTNAME 'Kennedy';
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Отключение пользователя.</title>

                        <para><programlisting language="sql"> 
ALTER USER dan INACTIVE;
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Отбор привилегии управления пользователями у пользователя.</title>

                        <para><programlisting language="sql"> 
ALTER USER dumbbell
REVOKE ADMIN ROLE;
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Изменение пользовательских атрибутов своей учётной записи.</title>

                        <para><programlisting language="sql"> 
ALTER CURRENT USER
TAGS (BIRTHYEAR = '1971', DROP CITY);
                </programlisting>
                            Атрибуту BIRTHDAY будет установлено новое значение, а атрибут CITY будет
                            удалён. </para>
                    </example>
                </para>
            </formalpara>
            <formalpara>
                <title>См. также:</title>

                <para>
                    <link linkend="security-user-create">CREATE USER</link>, <link
                        linkend="security-user-createoralter">CREATE OR ALTER USER</link>, <link
                        linkend="security-user-drop">DROP USER</link>. </para>
            </formalpara>
        </section>
        <section xml:id="security-user-createoralter">
            <info>
                <title>CREATE OR ALTER USER</title>
                <keywordset>
                    <keyword>CREATE OR ALTER USER</keyword>
                </keywordset>
            </info>
            <indexterm><primary>CREATE OR ALTER USER</primary></indexterm>
            <formalpara>
                <title>Назначение:</title>

                <para>Создание или изменение учётной записи пользователя Firebird.</para>
            </formalpara>

            <formalpara>
                <title>Доступно в:</title>

                <para>DSQL.</para>
            </formalpara>
            <formalpara>
                <title>Синтаксис:</title>

                <para><programlisting>
CREATE OR ALTER USER <replaceable>username</replaceable>
{ 
  [SET]
  [PASSWORD '<replaceable>password</replaceable>']
  [FIRSTNAME '<replaceable>firstname</replaceable>']
  [MIDDLENAME '<replaceable>middlename</replaceable>']
  [LASTNAME '<replaceable>lastname</replaceable>']
  [ACTIVE | INACTIVE]
  [TAGS (<replaceable>&lt;tag&gt;</replaceable> | DROP <replaceable>tagname</replaceable> [, <replaceable>&lt;tag&gt;</replaceable> | DROP <replaceable>tagname</replaceable> ...] )]
}
[USING PLUGIN <replaceable>pluginname</replaceable>] 
[{GRANT | REVOKE} ADMIN ROLE];
  
<replaceable>&lt;tag&gt;</replaceable> ::= <replaceable>tagname</replaceable> = '<replaceable>string value</replaceable>'                    
                </programlisting></para>
            </formalpara>
            <para>
                <table frame="all">
                    <title>Параметры оператора CREATE OR ALTER USER</title>
                    <?dbfo keep-together='auto'?>
                    <tgroup cols="2">
                        <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                        <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                        <thead>
                            <row>
                                <entry align="center">Параметр</entry>
                                <entry align="center">Описание</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry><replaceable>username</replaceable></entry>
                                <entry>
                                    <para>Имя пользователя. Максимальная длина 63 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>password</replaceable></entry>
                                <entry>
                                    <para>Пароль пользователя. Чувствительно к регистру.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>firstname</replaceable></entry>
                                <entry>
                                    <para>Вспомогательная информация: имя пользователя. Максимальная
                                        длина 32 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>middlename</replaceable></entry>
                                <entry>
                                    <para>Вспомогательная информация: &quot;второе имя&quot;
                                        (отчество, &quot;имя отца&quot;) пользователя. Максимальная
                                        длина 32 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>lastname</replaceable></entry>
                                <entry>
                                    <para>Вспомогательная информация: фамилия пользователя.
                                        Максимальная длина 32 символа.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>pluginname</replaceable></entry>
                                <entry>
                                    <para>Имя плагина управления пользователями, в котором
                                        необходимо создать нового пользователя или в котором он был
                                        создан ранее.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>tagname</replaceable></entry>
                                <entry>
                                    <para>Имя пользовательского атрибута. Максимальная длина 63
                                        символа. Имя атрибута должно подчиняться правилам
                                        наименования SQL идентификаторов.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>string value</replaceable></entry>
                                <entry>
                                    <para>Значение пользовательского атрибута. Максимальная длина
                                        255 символов.</para>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>

            <para>Оператор CREATE OR ALTER USER создаёт новую или изменяет учётную запись. Если
                пользователя не существует, то он будет создан с использованием предложения CREATE
                USER. Если он уже существует, то он будет изменён, при этом существующие привилегии
                сохраняются.</para>

            <formalpara>
                <title>Примеры:</title>

                <para>
                    <example>
                        <title>Создание или изменение пользователя.</title>

                        <para><programlisting language="sql"> 
CREATE OR ALTER USER john PASSWORD 'fYe_3Ksw'
FIRSTNAME 'John'
LASTNAME 'Doe'
INACTIVE;
                </programlisting>
                        </para>
                    </example>
                </para>
            </formalpara>

            <formalpara>
                <title>См. также:</title>

                <para>
                    <link linkend="security-user-create">CREATE USER</link>, <link
                        linkend="security-user-alter">ALTER USER</link>. </para>
            </formalpara>
        </section>
        <section xml:id="security-user-drop">
            <info>
                <title>DROP USER</title>
                <keywordset>
                    <keyword>DROP USER</keyword>
                </keywordset>
            </info>
            <indexterm><primary>DROP USER</primary></indexterm>
            <formalpara>
                <title>Назначение:</title>

                <para>Удаление учётной записи пользователя Firebird.</para>
            </formalpara>

            <formalpara>
                <title>Доступно в:</title>

                <para>DSQL.</para>
            </formalpara>
            <formalpara>
                <title>Синтаксис:</title>

                <para><programlisting>
DROP USER <replaceable>username</replaceable>
[USING PLUGIN <replaceable>pluginname</replaceable>];
                </programlisting></para>
            </formalpara>
            <para>
                <table frame="all">
                    <title>Параметры оператора DROP USER</title>
                    <?dbfo keep-together='auto'?>
                    <tgroup cols="2">
                        <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                        <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                        <thead>
                            <row>
                                <entry align="center">Параметр</entry>
                                <entry align="center">Описание</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry><replaceable>username</replaceable></entry>
                                <entry>
                                    <para>Имя пользователя.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>pluginname</replaceable></entry>
                                <entry>
                                    <para>Имя плагина управления пользователями, в котором был
                                        создан данный пользователь.</para>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>

            <para>Оператор DROP USER удаляет учётную запись пользователя Firebird.</para>
            <indexterm>
                <primary>DROP USER</primary>
                <secondary>USING PLUGIN</secondary>
            </indexterm>
            <para>Необязательное предложение USING PLUGIN позволяет явно указывать какой плагин
                управления пользователями будет использован. По умолчанию используется тот плагин,
                который был указан первым в списке параметра <parameter>UserManager</parameter> в
                файле конфигурации <filename>firebird.conf</filename>. Допустимыми являются только
                значения, перечисленные в параметре <parameter>UserManager</parameter>.</para>
            <important>
                <para>Учтите что одноименные пользователи, созданные с помощью разных плагинов
                    управления пользователями — это разные пользователи. Поэтому пользователя
                    созданного с помощью одного плагина управления пользователями можно удалить или
                    изменить, указав только тот же самый плагин.</para>
            </important>
            <para>Для удаления учётной записи пользователя текущий пользователь должен обладать
                административными привилегиями.</para>

            <formalpara>
                <title>Примеры:</title>

                <para>
                    <example>
                        <title>Удаление пользователя.</title>

                        <para><programlisting language="sql"> 
DROP USER bobby;
                </programlisting>
                        </para>
                    </example>
                    <example>
                        <title>Удаление пользователя, созданного с помощью плагина управления
                            пользователями Legacy_UserManager.</title>

                        <para><programlisting language="sql"> 
DROP USER Godzilla USING PLUGIN Legacy_UserManager;
                </programlisting>
                        </para>
                    </example>
                </para>
            </formalpara>

            <formalpara>
                <title>См. также:</title>

                <para>
                    <link linkend="security-user-create">CREATE USER</link>, <link
                        linkend="security-user-alter">ALTER USER</link>. </para>
            </formalpara>
        </section>
        <section xml:id="security-user-list">
            <title>Получение списка пользователей</title>
            <para>Для получения списка пользователей и их атрибутов вы можете воспользоваться псевдо
                таблицами <database>SEC$USERS</database> и
                <database>SEC$USER_ATTRIBUTES</database>.</para>
            <example>
                <title>Отображение списка пользователей и их атрибутов</title>
                <para>
                    <programlisting language="sql"> 
SELECT CAST(U.SEC$USER_NAME AS CHAR(20)) AS LOGIN,
    CAST(A.SEC$KEY AS CHAR(10)) AS TAG,
    CAST(A.SEC$VALUE AS CHAR(20)) AS "VALUE",
    U.SEC$PLUGIN AS "PLUGIN"
FROM SEC$USERS U LEFT JOIN SEC$USER_ATTRIBUTES A
    ON U.SEC$USER_NAME = A.SEC$USER_NAME
   AND U.SEC$PLUGIN = A.SEC$PLUGIN;                            
                            </programlisting>
                    <screen>
   LOGIN                TAG        VALUE                PLUGIN
   ==================== ========== ==================== ==========================
   SYSDBA               &lt;null&gt;     &lt;null&gt;               Srp
   ALEX                 B          x                    Srp
   ALEX                 C          sample               Srp
   SYSDBA               &lt;null&gt;     &lt;null&gt;               Legacy_UserManager                            
                        </screen>
                </para>
            </example>
            <formalpara>
                <title>Подробное описание псевдо таблиц безопасности смотри в:</title>

                <para>
                    <link linkend="sectables-users">SEC$USERS</link>, <link
                        linkend="sectables-user_attributes">SEC$USER_ATTRIBUTES</link>. </para>
            </formalpara>
        </section>
    </section>

    <section xml:id="security-roles">
        <info>
            <title>Роли</title>
            <keywordset>
                <keyword>ROLE</keyword>
            </keywordset>
        </info>
        <indexterm><primary>ROLE</primary></indexterm>

        <para><emphasis role="bold">Роль</emphasis> (role) — объект базы данных, представляющий
            набор привилегий. Роли реализуют концепцию управления безопасностью на групповом уровне.
            Множество привилегий предоставляется роли, а затем роль может быть предоставлена или
            отозвана у одного или нескольких пользователей. </para>
        <para>Пользователь, которому предоставлена роль, должен указать её при входе, для того чтобы
            получить её привилегии, или же эта роль должна быть грантована с использованием
            ключевого слова DEFAULT. Любые другие привилегии, предоставленные пользователю, не будут
            затронуты при его входе в систему с указанной ролью. Вход в систему с несколькими ролями
            не поддерживается, однако вы можете права нескольких ролей назначенных по умолчанию. Вы
            можете изменить текущую роль с помощью оператора <link
                linkend="security-changerole-setrole">SET ROLE</link>.</para>
        <para>Роли могут быть грантованы другие роли. При входе с этой ролью пользователь
            автоматически получит права всех ролей выданных с использованием ключевого слова
            DEFAULT.</para>

        <section xml:id="security-roles-managment">
            <title>Операторы управления ролями</title>
            <para>В данном разделе рассматриваются вопросы создания и удаления ролей.</para>
            <section xml:id="security-roles-create">
                <info>
                    <title>CREATE ROLE</title>
                    <keywordset>
                        <keyword>CREATE ROLE</keyword>
                    </keywordset>
                </info>
                <indexterm><primary>CREATE ROLE</primary></indexterm>
                <formalpara>
                    <title>Назначение:</title>

                    <para>Создание новой роли.</para>
                </formalpara>

                <formalpara>
                    <title>Доступно в:</title>

                    <para>DSQL, ESQL.</para>
                </formalpara>
                <formalpara>
                    <title>Синтаксис:</title>

                    <para><programlisting>
CREATE ROLE <replaceable>rolename</replaceable> [SET SYSTEM PRIVILEGES TO <replaceable>&lt;privileges_list&gt;</replaceable>]    

<replaceable>&lt;privileges_list&gt;</replaceable> ::= <replaceable>&lt;privilege&gt;</replaceable> [, <replaceable>&lt;privilege&gt;</replaceable> [, <replaceable>&lt;privilege&gt;</replaceable> ...]] 
          
                </programlisting></para>
                </formalpara>
                <para>
                    <table frame="all">
                        <?dbfo keep-together='auto'?>
                        <title>Параметры оператора CREATE ROLE</title>
                        <tgroup cols="2">
                            <colspec colname="colArgument" colnum="1" colwidth="1.2*" align="left"/>
                            <colspec colname="colDesc" colnum="2" colwidth="2.8*" align="justify"/>
                            <thead>
                                <row valign="middle">
                                    <entry align="center">Параметр</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry><replaceable>rolename</replaceable></entry>
                                    <entry>
                                        <para>Имя роли. Максимальная длина 63 символа.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>privilege</replaceable></entry>
                                    <entry>
                                        <para>Системная привилегия.</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <para>Оператор CREATE ROLE создаёт новую роль. Имя роли должно быть уникальным среди
                    имён ролей.</para>
                <warning>
                    <para>Желательно также чтобы имя роли было уникальным не только среди имён
                        ролей, но и среди имён пользователей. Если вы создадите роль с тем же именем
                        существующего пользователя, то такой пользователь не сможет подключиться к
                        базе данных. </para>
                </warning>
                <indexterm>
                    <primary>CREATE ROLE</primary>
                    <secondary>SET SYSTEM PRIVILEGES TO</secondary>
                </indexterm>
                <para>Предложение <database>SET SYSTEM PRIVILEGES TO</database> позволяет создать
                    роль с системными привилегиями. Системные привилегии это части привилегий
                    администратора. Таким образом, через делегирование роли с системными
                    привилегиями пользователю можно передавать ему часть прав администратора
                    БД.</para>

                <note>
                    <para>Системные привилегии позволяют производить очень тонкую настройку, поэтому
                        иногда вам нужно будет выдать более 1 системной привилегии для выполнения
                        какой-либо задачи. Например, необходимо выдать IGNORE_DB_TRIGGERS совместно
                        с USE_GSTAT_UTILITY, потому что <application>gstat</application> должен
                        игнорировать триггера на события БД. </para>
                </note>

                <para>
                    <table frame="all">
                        <?dbfo keep-together='auto'?>
                        <title>Системные привилегии</title>
                        <tgroup cols="2">
                            <colspec colname="colArgument" colnum="1" colwidth="1.8*" align="left"/>
                            <colspec colname="colDesc" colnum="2" colwidth="2.2*" align="justify"/>
                            <thead>
                                <row valign="middle">
                                    <entry align="center">Привилегия</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry>USER_MANAGEMENT</entry>
                                    <entry>
                                        <para>Управление пользователями.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>READ_RAW_PAGES</entry>
                                    <entry>
                                        <para>Чтение страниц в сыром формате используя
                                            Attachment::getInfo()</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>CREATE_USER_TYPES</entry>
                                    <entry>
                                        <para>Создание, изменение и удаление не системных записей в
                                            таблице RDB$USER_TYPES.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>USE_NBACKUP_UTILITY</entry>
                                    <entry>
                                        <para>Использование <application>nbackup</application> для
                                            создания резервных копий.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>CHANGE_SHUTDOWN_MODE</entry>
                                    <entry>
                                        <para>Закрытие базы данных (shutdown) и возвращаение её в
                                            online.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>TRACE_ANY_ATTACHMENT</entry>
                                    <entry>
                                        <para>Трассировка чужих пользовательских сессий.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>MONITOR_ANY_ATTACHMENT</entry>
                                    <entry>
                                        <para>Мониторинг (MON$ таблицы) чужих пользовательских
                                            сессий.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>ACCESS_SHUTDOWN_DATABASE</entry>
                                    <entry>
                                        <para>Доступ к базе данных в режиме shutdown.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>CREATE_DATABASE</entry>
                                    <entry>
                                        <para>Создание новой базы данных (хранится в базе данных
                                            пользователей security.db).</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>DROP_DATABASE</entry>
                                    <entry>
                                        <para>Удаление текущей БД.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>USE_GBAK_UTILITY</entry>
                                    <entry>
                                        <para>Использование утилиты или сервиса
                                                <application>gbak</application>.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>USE_GSTAT_UTILITY</entry>
                                    <entry>
                                        <para>Использование утилиты или сервиса
                                                <application>gstat</application>.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>USE_GFIX_UTILITY</entry>
                                    <entry>
                                        <para>Использование утилиты или сервиса
                                                <application>gfix</application>.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>IGNORE_DB_TRIGGERS</entry>
                                    <entry>
                                        <para>Разрешает игнорировать триггеры на события БД.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>CHANGE_HEADER_SETTINGS</entry>
                                    <entry>
                                        <para>Изменение параметров на заголовочной странице
                                            БД.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>SELECT_ANY_OBJECT_IN_DATABASE</entry>
                                    <entry>
                                        <para>Выполнение оператора SELECT из всех селективных
                                            объектов (таблиц, представлений, хранимых процедур
                                            выбора).</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>ACCESS_ANY_OBJECT_IN_DATABASE</entry>
                                    <entry>
                                        <para>Доступ (любым способом) к любому объекту БД.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>MODIFY_ANY_OBJECT_IN_DATABASE</entry>
                                    <entry>
                                        <para>Изменение любого объекта БД.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>CHANGE_MAPPING_RULES</entry>
                                    <entry>
                                        <para>Изменение правил отображения при
                                            аутентификации.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>USE_GRANTED_BY_CLAUSE</entry>
                                    <entry>
                                        <para>Использование GRANTED BY в операторах GRANT и
                                            REVOKE.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>GRANT_REVOKE_ON_ANY_OBJECT</entry>
                                    <entry>
                                        <para>Выполнение операторов GRANT и REVOKE для любого
                                            объекта БД.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>GRANT_REVOKE_ANY_DDL_RIGHT</entry>
                                    <entry>
                                        <para>Выполнение операторов GRANT и REVOKE для выдачи DDL
                                            привилегий.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>CREATE_PRIVILEGED_ROLES</entry>
                                    <entry>
                                        <para>Создание привилегированных ролей (с использование SET
                                            SYSTEM PRIVILEGES).</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>GET_DBCRYPT_KEY_NAME</entry>
                                    <entry><para>Получение имени ключа шифрования.</para></entry>
                                </row>
                                <row>
                                    <entry>MODIFY_EXT_CONN_POOL</entry>
                                    <entry><para>Управление пулом внешних соединений.</para></entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <para>Для проверки имеет ли текущее подключение заданную системную привилегию можно
                    воспользоваться встроенной функцией <link
                        linkend="internalfunc-func-security-sysprivelege"
                        >RDB$SYSTEM_PRIVILEGE</link>.</para>

                <para>Выполнить оператор <database>CREATE ROLE</database> могут: <itemizedlist
                        spacing="compact">
                        <listitem>
                            <para><link linkend="security-administrators"
                                >Администраторы</link></para>
                        </listitem>
                        <listitem>
                            <para>Пользователи с привилегией <database>CREATE ROLE</database>.
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>

                <formalpara>
                    <title>Примеры:</title>
                    <para>
                        <example>
                            <title>Создание роли.</title>

                            <para><programlisting language="sql"> 
CREATE ROLE SELLERS;                 
                </programlisting>
                            </para>
                        </example>
                        <example>
                            <title>Создание роли с системными привилегиями.</title>

                            <para><programlisting language="sql"> 
CREATE ROLE SYS_UTILS 
SET SYSTEM PRIVILEGES TO USE_GBAK_UTILITY, USE_GSTAT_UTILITY, IGNORE_DB_TRIGGERS;                 
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>
                <formalpara>
                    <title>См. также:</title>

                    <para>
                        <link linkend="security-roles-drop">DROP ROLE</link>, <link
                            linkend="security-priv-grant">GRANT</link>, <link
                            linkend="security-priv-revoke">REVOKE</link>, <link
                            linkend="security-changerole-setrole">SET ROLE</link>, <link
                            linkend="internalfunc-func-security-sysprivelege"
                            >RDB$SYSTEM_PRIVILEGE</link>. </para>

                </formalpara>
            </section>
            <section xml:id="security-roles-alter">
                <info>
                    <title>ALTER ROLE</title>
                </info>

                <formalpara>
                    <title>Назначение:</title>

                    <para>Изменение системных привилегий роли.</para>
                </formalpara>

                <formalpara>
                    <title>Доступно в:</title>

                    <para>DSQL, ESQL.</para>
                </formalpara>
                <formalpara>
                    <title>Синтаксис:</title>

                    <para><programlisting>
ALTER ROLE <replaceable>rolename</replaceable> 
{
    SET SYSTEM PRIVILEGES TO <replaceable>&lt;privileges_list&gt;</replaceable>
  | DROP SYSTEM PRIVILEGES   
}  
                      

<replaceable>&lt;privileges_list&gt;</replaceable> ::= <replaceable>&lt;privilege&gt;</replaceable> [, <replaceable>&lt;privilege&gt;</replaceable> [, <replaceable>&lt;privilege&gt;</replaceable> ...]] 
          
                </programlisting>
                        Только для роли RDB$ADMIN
                        <programlisting>

ALTER ROLE RDB$ADMIN {SET | DROP} AUTO ADMIN MAPPING 
                </programlisting>
                    </para>
                </formalpara>

                <para>
                    <table frame="all">
                        <?dbfo keep-together='auto'?>
                        <title>Параметры оператора ALTER ROLE</title>
                        <tgroup cols="2">
                            <colspec colname="colArgument" colnum="1" colwidth="1.2*" align="left"/>
                            <colspec colname="colDesc" colnum="2" colwidth="2.8*" align="justify"/>
                            <thead>
                                <row valign="middle">
                                    <entry align="center">Параметр</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry><replaceable>rolename</replaceable></entry>
                                    <entry>
                                        <para>Имя роли.</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry><replaceable>privilege</replaceable></entry>
                                    <entry>
                                        <para>Системная привилегия.</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <para>Оператор ALTER ROLE изменяет список системных привилегий роли или удаляет их.
                    При использовании предложения SET SYSTEM PRIVILEGES TO к роли добавляются
                    системные привилегии из списка. Для очистки списка системных привилегий
                    установленных предыдущим оператором используйте оператор ALTER ROLE с
                    предложением DROP SYSTEM PRIVILEGES. </para>

                <para>Оператор ALTER ROLE RDB$ADMIN для включения и отключения возможности
                    администраторам Windows автоматически получать привилегии <link
                        linkend="security-administrators">администраторов</link> при входе.</para>

                <para>Эта возможность существует только для одной роли, а именно системной роли
                    RDB$ADMIN, которая существует в любой базе данных с ODS 11.2 и выше. Подробности
                    см. в <link linkend="security-autoadminmapping">AUTO ADMIN MAPPING</link>. В
                    настоящее время является устаревшим и поддерживается для обратной совместимости,
                    вместо него рекомендуется использовать операторы <link
                        linkend="security-mapping">{CREATE | ALTER | DROP} MAPPING</link>.</para>

            </section>
            <section xml:id="security-roles-drop">
                <info>
                    <title>DROP ROLE</title>
                    <keywordset>
                        <keyword>DROP ROLE</keyword>
                    </keywordset>
                </info>
                <indexterm><primary>DROP ROLE</primary></indexterm>
                <formalpara>
                    <title>Назначение:</title>

                    <para>Удаление существующей роли.</para>
                </formalpara>

                <formalpara>
                    <title>Доступно в:</title>

                    <para>DSQL, ESQL.</para>
                </formalpara>
                <formalpara>
                    <title>Синтаксис:</title>

                    <para><programlisting>
DROP ROLE <replaceable>rolename</replaceable>;                    
                </programlisting></para>
                </formalpara>
                <para>
                    <table frame="all">
                        <?dbfo keep-together='auto'?>
                        <title>Параметры оператора DROP ROLE</title>
                        <tgroup cols="2">
                            <colspec colname="colArgument" colnum="1" colwidth="1.2*" align="left"/>
                            <colspec colname="colDesc" colnum="2" colwidth="2.8*" align="justify"/>
                            <thead>
                                <row valign="middle">
                                    <entry align="center">Параметр</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry><replaceable>rolename</replaceable></entry>
                                    <entry>
                                        <para>Имя роли.</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <para>Оператор DROP ROLE удаляет существующую роль. При удалении роли все
                    привилегии, предоставленные этой роли, отменяются.</para>

                <para>Выполнить оператор <database>DROP ROLE</database> могут: <itemizedlist
                        spacing="compact">
                        <listitem>
                            <para><link linkend="security-administrators"
                                >Администраторы</link></para>
                        </listitem>
                        <listitem>
                            <para>Владелец роли; </para>
                        </listitem>
                        <listitem>
                            <para>Пользователи с привилегией <database>ALTER ANY ROLE</database>.
                            </para>
                        </listitem>
                    </itemizedlist>
                </para>

                <formalpara>
                    <title>Примеры:</title>
                    <para>
                        <example>
                            <title>Удаление роли.</title>

                            <para><programlisting language="sql"> 
DROP ROLE SELLERS;      
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>
                <formalpara>
                    <title>См. также:</title>

                    <para>
                        <link linkend="security-roles-create">CREATE ROLE</link>, <link
                            linkend="security-priv-grant">GRANT</link>, <link
                            linkend="security-priv-revoke">REVOKE</link>. </para>

                </formalpara>
            </section>
        </section>
        <section xml:id="security-sysroles">
            <info>
                <title>Системные роли</title>
            </info>
            <section xml:id="security-sysroles-rdbadmin">
                <info>
                    <title>RDB$ADMIN</title>
                    <keywordset>
                        <keyword>RDB$ADMIN</keyword>
                    </keywordset>
                </info>
                <indexterm><primary>RDB$ADMIN</primary></indexterm>
                <para>Системная роль RDB$ADMIN, присутствует в каждой базе данных. Предоставление
                    пользователю роли RDB$ADMIN в базе данных даёт ему права SYSDBA, но только в
                    текущей базе данных.</para>
                <para>Привилегии вступают в силу сразу после входа в обычную базу данных с указанием
                    роли RDB$ADMIN, после чего пользователь получает полный контроль над всеми
                    объектами базы данных. </para>
                <para>Роль RDB$ADMIN может быть предоставлена с использованием ключевого слова
                    DEFAULT. В этом случае пользователь автоматически будет получать
                    административные привилегии даже если он не указал роль RDB$ADMIN при
                    входе.</para>
                <para>Предоставление в базе данных безопасности даёт возможность создавать, изменять
                    и удалять учётные записи пользователей.</para>
                <para>В обоих случаях пользователь с правами RDB$ADMIN роли может всегда передавать
                    эту роль другим. Другими словами, <quote>WITH ADMIN OPTION</quote> уже встроен в
                    эту роль и эту опцию можно не указывать.</para>
                <section xml:id="security-sysroles-rdbadmin-grantindb">
                    <info>
                        <title>Предоставление роли RDB$ADMIN в обычной базе данных</title>
                    </info>

                    <para>Для предоставления и удаления роли RDB$ADMIN в обычной базе данных
                        используются операторы GRANT и REVOKE, как и для назначения и отмены
                        остальных ролей.</para>
                    <formalpara>
                        <title>Синтаксис:</title>

                        <para><programlisting>
GRANT [DEFAULT] RDB$ADMIN TO <replaceable>username</replaceable>
 
REVOKE [DEFAULT] RDB$ADMIN FROM <replaceable>username</replaceable>
                       </programlisting></para>
                    </formalpara>
                    <para>
                        <table frame="all">
                            <title>Параметры операторов установки и отмены роли RDB$ADMIN</title>
                            <?dbfo keep-together='auto'?>
                            <tgroup cols="2">
                                <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                                <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                                <thead>
                                    <row>
                                        <entry align="center">Параметр</entry>
                                        <entry align="center">Описание</entry>
                                    </row>
                                </thead>
                                <tbody>
                                    <row>
                                        <entry><replaceable>username</replaceable></entry>
                                        <entry>
                                            <para>Имя пользователя, которому назначается роль
                                                RDB$ADMIN или у которого она отбирается.</para>
                                        </entry>
                                    </row>
                                </tbody>
                            </tgroup>
                        </table>
                    </para>

                    <para>Если в операторе GRANT присутствует ключевое слово DEFAULT, то
                        пользователь автоматически будет получать административные привилегии даже
                        если он не указал роль RDB$ADMIN при входе. Привилегии на роль RDB$ADMIN
                        могут давать только <link linkend="security-administrators"
                            >администраторы</link>. </para>
                    <formalpara>
                        <title>См. также:</title>

                        <para>
                            <link linkend="security-priv-grant">GRANT</link>, <link
                                linkend="security-priv-revoke">REVOKE</link>. </para>
                    </formalpara>

                    <section xml:id="security-sysroles-rdbadmin-useindb">
                        <title>Использование роли RDB$ADMIN в обычной базе данных</title>

                        <para>Для использования прав роли RDB$ADMIN пользователь просто указывает её
                            при соединении с базой данных, или же роль RDB$ADMIN выдали пользователю
                            с использованием ключевого слова DEFAULT. Он также может указать её
                            позднее с помощью оператора SET ROLE.</para>
                    </section>
                </section>

                <section xml:id="security-sysroles-rdbadmin-grantinsecuritydb">
                    <title>Предоставление роли RDB$ADMIN в базе данных пользователей</title>

                    <para>Так как никто не может соединиться с базой данных пользователей, то
                        операторы GRANT и REVOKE здесь не могут использоваться. Вместо этого роль
                        RDB$ADMIN предоставляют и удаляют SQL командами управления пользователями:
                        CREATE USER и ALTER USER, в которых указываются специальные опции GRANT
                        ADMIN ROLE и REVOKE ADMIN ROLE. </para>
                    <formalpara>
                        <info>
                            <title>Синтаксис (неполный):</title>
                        </info>

                        <para><programlisting>
CREATE USER <replaceable>newuser</replaceable> 
PASSWORD '<replaceable>password</replaceable>' 
GRANT ADMIN ROLE
 
ALTER USER <replaceable>existinguser</replaceable> 
GRANT ADMIN ROLE
 
ALTER USER <replaceable>existinguser</replaceable> 
REVOKE ADMIN ROLE
                       </programlisting></para>
                    </formalpara>
                    <para>
                        <table frame="all">
                            <title>Параметры операторов установки и отмены роли RDB$ADMIN</title>
                            <?dbfo keep-together='auto'?>
                            <tgroup cols="2">
                                <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                                <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                                <thead>
                                    <row>
                                        <entry align="center">Параметр</entry>
                                        <entry align="center">Описание</entry>
                                    </row>
                                </thead>
                                <tbody>
                                    <row>
                                        <entry><replaceable>newuser</replaceable></entry>
                                        <entry>
                                            <para>Имя вновь создаваемого пользователя. Максимальная
                                                длина 63 символа.</para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry><replaceable>existinguser</replaceable></entry>
                                        <entry>
                                            <para>Имя существующего пользователя.</para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry><replaceable>password</replaceable></entry>
                                        <entry>
                                            <para>Пароль пользователя. Чувствительно к
                                                регистру.</para>
                                        </entry>
                                    </row>
                                </tbody>
                            </tgroup>
                        </table>
                    </para>

                    <important>
                        <para>Пожалуйста, помните, что GRANT ADMIN ROLE и REVOKE ADMIN ROLE это не
                            операторы GRANT и REVOKE. Это параметры для CREATE USER и ALTER
                            USER.</para>
                    </important>
                    <para>Привилегии на роль RDB$ADMIN могут давать только <link
                            linkend="security-administrators">администраторы</link>. </para>
                    <formalpara>
                        <title>См. также:</title>

                        <para>
                            <link linkend="security-priv-grant">GRANT</link>, <link
                                linkend="security-priv-revoke">REVOKE</link>. </para>
                    </formalpara>

                    <section xml:id="security-rdbadmin-grantinsecuritydb-gsec">
                        <title>Выполнение той же задачи используя утилиту
                                <application>gsec</application></title>

                        <para>То же самое можно сделать используя утилиту
                                <application>gsec</application> указав параметр
                                <parameter>-admin</parameter> для сохранения атрибута
                                <database>RDB$ADMIN</database> учётной записи пользователя: <blockquote>
                                <literallayout class="monospaced">
gsec -add new_user -pw password -admin yes
gsec -mo existing_user -admin yes
gsec -mo existing_user -admin no
            </literallayout>
                            </blockquote>
                        </para>
                        <note>
                            <para>В зависимости от административного статуса текущего пользователя
                                для утилиты <application>gsec</application> может потребоваться
                                больше параметров, таких как <parameter>-user</parameter> и
                                    <parameter>-pass</parameter>, или
                                    <parameter>-trusted</parameter>.</para>
                        </note>

                    </section>

                    <section xml:id="security-sysroles-rdbadmin-useinsecuritydb">
                        <title>Использование роли RDB$ADMIN в базе данных пользователей</title>

                        <para>Для управления учётными записями пользователей через SQL пользователь,
                            имеющий права на роль RDB$ADMIN, должен подключиться к базе данных с
                            этой ролью. Так как к базе данных пользователей не имеет права
                            соединяться никто, то пользователь должен подключиться к обычной базе
                            данных, где он также имеет права на роль RDB$ADMIN. Он определяет роль
                            при соединении с обычной базой данных и может в ней выполнить любой SQL
                            запрос. Это не самое элегантное решение, но это единственный способ
                            управлять пользователями через SQL запросы. </para>
                        <para>Если нет обычной базы данных, где у пользователя есть права на роль
                            RDB$ADMIN, то управление учётными записями посредством SQL запросов
                            недоступно.</para>
                    </section>

                    <section xml:id="security-sysroles-rdbadmin-useingsec">
                        <title>Использование роли RDB$ADMIN в
                            <application>gsec</application></title>

                        <para>Для управления пользователями через утилиту
                                <application>gsec</application> роль RDB$ADMIN должна быть указана в
                            переключателе <parameter>-role</parameter>.</para>
                    </section>
                </section>

                <section xml:id="security-autoadminmapping">
                    <info>
                        <title>AUTO ADMIN MAPPING</title>
                        <keywordset>
                            <keyword>AUTO ADMIN MAPPING</keyword>
                        </keywordset>
                    </info>
                    <formalpara>
                        <title>Операционная система:</title>

                        <para>только Windows.</para>
                    </formalpara>
                    <para>Администраторы операционной системы Windows автоматически не получают
                        права SYSDBA при подключении к базе данных (если, конечно, разрешена
                        доверенная авторизация). Имеют ли администраторы автоматические права SYSDBA
                        зависит от установки значения флага AUTO ADMIN MAPPING. Это флаг в каждой из
                        баз данных, который по умолчанию выключен. Если флаг AUTO ADMIN MAPPING
                        включен, то он действует, когда администратор Windows: <orderedlist
                            numeration="loweralpha" spacing="compact">
                            <listitem>
                                <para>подключается с помощью доверенной аутентификации</para>
                            </listitem>
                            <listitem>
                                <para>не определяет никакой роли при подключении.</para>
                            </listitem>
                        </orderedlist></para>
                    <para>После успешного “auto admin” подключения текущей ролью будет являться
                        RDB$ADMIN. </para>
                    <section xml:id="security-autoadminmapping01">
                        <info>
                            <title>Включение и выключение AUTO ADMIN MAPPING в обычной базе
                                данных</title>

                            <keywordset>
                                <keyword>AUTO ADMIN MAPPING</keyword>
                            </keywordset>
                        </info>

                        <indexterm><primary>ALTER ROLE RDB$ADMIN SET AUTO ADMIN
                            MAPPING</primary></indexterm>
                        <indexterm><primary>ALTER ROLE RDB$ADMIN DROP AUTO ADMIN
                            MAPPING</primary></indexterm>

                        <para>Включение и выключение флага AUTO ADMIN MAPPING в обычной базе данных
                            осуществляется следующим образом:
                            <programlisting language="sql">
ALTER ROLE RDB$ADMIN SET AUTO ADMIN MAPPING -- включение
 
ALTER ROLE RDB$ADMIN DROP AUTO ADMIN MAPPING -- выключение                   
                </programlisting>
                        </para>
                        <para>Эти операторы могут быть выполнены пользователями с достаточными
                            правами, а именно: <itemizedlist spacing="compact">
                                <listitem>
                                    <para>владелец базы данных;</para>
                                </listitem>
                                <listitem>
                                    <para>
                                        <link linkend="security-administrators"
                                            >администраторы</link>. </para>
                                </listitem>
                            </itemizedlist>
                        </para>

                        <note>
                            <para>Оператор
                                <programlisting language="sql">
ALTER ROLE RDB$ADMIN SET AUTO ADMIN MAPPING
                    </programlisting>
                                является упрощённым видом оператора создания отображения
                                предопределённой группы DOMAIN_ANY_RID_ADMINS на роль RDB$ADMIN.
                                <programlisting language="sql">
CREATE MAPPING WIN_ADMINS
USING PLUGIN WIN_SSPI
FROM Predefined_Group
DOMAIN_ANY_RID_ADMINS
TO ROLE RDB$ADMIN;                        
                    </programlisting>
                                Соответственно оператор
                                <programlisting language="sql">
ALTER ROLE RDB$ADMIN DROP AUTO ADMIN MAPPING
                    </programlisting>
                                эквивалентен оператору
                                <programlisting language="sql">
DROP MAPPING WIN_ADMINS;
                    </programlisting>
                            </para>
                            <para>Подробней см. <link linkend="security-mapping">Отображение
                                    объектов безопасности</link>.</para>
                        </note>

                        <para>В обычных базах данных статус AUTO ADMIN MAPPING проверяется только во
                            время подключения. Если Администратор имеет роль RDB$ADMIN потому, что
                            произошло автоматическое отображение во время входа, то он будет
                            удерживать эту роль на протяжении всей сессии, даже если он или кто-то
                            другой в это же время выключает автоматическое отображение.</para>

                        <para>Точно также, включение AUTO ADMIN MAPPING не изменит текущую роль в
                            RDB$ADMIN для Администраторов, которые уже подключились.</para>

                    </section>
                    <section xml:id="security-autoadminmapping02">
                        <info>
                            <title>Включение и выключение AUTO ADMIN MAPPING в базе данных
                                безопасности</title>
                        </info>

                        <para>Оператором ALTER ROLE RDB$ADMIN невозможно включить или выключить флаг
                            AUTO ADMIN MAPPING в базе данных пользователей. Однако вы можете создать
                            глобальное отображение предопределённой группы DOMAIN_ANY_RID_ADMINS на
                            роль RDB$ADMIN следующим образом:
                            <programlisting language="sql">
CREATE GLOBAL MAPPING WIN_ADMINS
USING PLUGIN WIN_SSPI
FROM Predefined_Group
DOMAIN_ANY_RID_ADMINS
TO ROLE RDB$ADMIN;                        
                    </programlisting>
                        </para>
                        <para>Кроме того для включения AUTO ADMIN MAPPING в базе данных
                            пользователей можно использовать утилиту командной строки
                                <application>gsec</application>:
                            <screen>
gsec -mapping set
 
gsec -mapping drop                
            </screen>
                        </para>
                        <note>
                            <para>В зависимости от административного статуса текущего пользователя
                                для утилиты <application>gsec</application> может потребоваться
                                больше параметров, таких как <parameter>-user</parameter> и
                                    <parameter>-pass</parameter>, или
                                    <parameter>-trusted</parameter>.</para>
                        </note>

                        <para>Только SYSDBA может включить AUTO ADMIN MAPPING, если он выключен, но
                            любой администратор может выключить его.</para>

                        <para>При выключении AUTO ADMIN MAPPING пользователь отключает сам механизм,
                            который предоставлял ему доступ и, таким образом, он не сможет обратно
                            включить AUTO ADMIN MAPPING. Даже в интерактивном
                                <application>gsec</application> сеансе новая установка флага сразу
                            вступает в силу.</para>
                    </section>
                </section>
            </section>
        </section>

        <section xml:id="security-changerole">
            <info>
                <title>Изменение текущей роли</title>
            </info>
            <section xml:id="security-changerole-setrole">
                <info>
                    <title>SET ROLE</title>
                    <keywordset>
                        <keyword>SET ROLE</keyword>
                    </keywordset>
                </info>
                <indexterm><primary>SET ROLE</primary></indexterm>
                <formalpara>
                    <title>Назначение:</title>

                    <para>Изменение текущей роли.</para>
                </formalpara>

                <formalpara>
                    <info>
                        <title>Доступно в:</title>
                    </info>

                    <para>DSQL.</para>
                </formalpara>
                <formalpara>
                    <title>Синтаксис:</title>


                    <para><programlisting>
SET ROLE <replaceable>rolename</replaceable>  
                       </programlisting></para>
                </formalpara>
                <para>
                    <table frame="all">
                        <title>Параметры оператора SET ROLE</title>
                        <?dbfo keep-together='auto'?>
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                            <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                            <thead>
                                <row>
                                    <entry align="center">Параметр</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry><replaceable>rolename</replaceable></entry>
                                    <entry>
                                        <para>Имя устанавливаемой роли.</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <para>Согласно стандарту SQL-2008 оператор SET ROLE позволяет установить контекстной
                    переменной CURRENT_ROLE одну из назначенных ролей для пользователя CURRENT_USER
                    или роль, полученную в результате доверительной аутентификации (в этом случае
                    оператор принимает вид SET TRUSTED ROLE).</para>

                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Изменение текущей роли</title>
                            <para><programlisting language="sql">
SET ROLE manager;
select current_role from rdb$database;
              
                </programlisting>
                                <screen>
ROLE
=======================
MANAGER                    
                </screen>
                            </para>
                        </example>
                    </para>
                </formalpara>
            </section>
            <section xml:id="security-changerole-settrustedrole">
                <info>
                    <title>SET TRUSTED ROLE</title>
                    <keywordset>
                        <keyword>SET TRUSTED ROLE</keyword>
                    </keywordset>
                </info>
                <indexterm><primary>SET TRUSTED ROLE</primary></indexterm>
                <formalpara>
                    <title>Назначение:</title>

                    <para>Установка доверенной роли.</para>
                </formalpara>

                <formalpara>
                    <title>Доступно в:</title>

                    <para>DSQL.</para>
                </formalpara>
                <formalpara>
                    <title>Синтаксис:</title>

                    <para><programlisting>
SET TRUSTED ROLE 
                       </programlisting></para>
                </formalpara>

                <para>Оператор SET TRUSTED ROLE включает доступ доверенной роли, при условии, что
                    CURRENT_USER получен с помощью доверительной аутентификации и роль
                    доступна.</para>
                <para>Идея отдельной команды SET TRUSTED ROLE состоит в том, чтобы при подключении
                    доверенного пользователя не указывать никакой дополнительной информации о роли,
                    SET TRUSTED ROLE делает доверенную роль (если таковая существует) текущей ролью
                    без дополнительной деятельности, связанной с установкой параметров DBP.</para>
                <para>Доверенная роль это не специальный тип роли, ей может быть любая роль,
                    созданная с помощью оператора CREATE ROLE или предопределённая системная роль
                    RDB$ADMIN. Она становится доверенной ролью для подключения, когда подсистема
                    отображения объектов безопасности (security objects mapping subsystem) находит
                    соответствие между результатом аутентификации, полученным от плагина и локальным
                    или глобальным отображением (mapping) для текущей базы данных. Роль даже может
                    быть той, которая не предоставлена явно этому доверенному пользователю. </para>
                <note>
                    <para>Доверенная роль не назначается при подключении по умолчанию. Можно
                        изменить это поведение, используя соответствующий плагин аутентификации и
                        команды CREATE/ALTER MAPPING.</para>
                </note>
                <para>Примером использования доверенной роли является назначение системной роли
                    RDB$ADMIN для администраторов Windows, когда используется доверительная
                    аутентификация Windows.</para>
            </section>
        </section>
    </section>

    <section xml:id="security-priv">
        <info>
            <title>SQL привилегии</title>
        </info>
        <para>Вторым уровень модели обеспечения безопасности Firebird являются SQL привилегии. После
            успешного входа в систему (первый уровень), авторизованный пользователь получает доступ
            к серверу и ко всем базам данных этого сервера, но это не означает, что он имеет доступ
            к любым объектам в любой базе данных. После создания объекта, только пользователь
            создавший объект (его владелец) и администраторы имеют доступ к нему. Пользователю
            необходимы привилегии на каждый объект, к которому он должен получить доступ. Как
            правило, привилегии должны быть предоставлены явно пользователю владельцем объекта или
                <link linkend="security-administrators">администратором</link> базы данных.</para>
        <para>Привилегия включает тип DML доступа (SELECT, INSERT, UPDATE, DELETE, EXECUTE и
            REFERENCES), имя объекта базы данных для которого предоставляется привилегия (таблица,
            представление, процедура или роль) и имя объекта которому предоставляется привилегия
            (пользователь, процедура, триггер, роль). Существуют различные способы для
            предоставления нескольких типов доступа на один объект базы данных сразу нескольким
            пользователям в одном операторе GRANT. Привилегии могут быть отозваны с помощью
            оператора REVOKE.</para>
        <para>Все привилегии по доступу к объектам базы данных хранятся в самой базе, и не могут
            быть применены к любой другой базе данных. </para>

        <section xml:id="security-owner">
            <title>Владелец объекта базы данных</title>

            <para>Пользователь, создавший объект базы данных, становится его владельцем. Только
                владелец объекта и пользователи с правами <link linkend="security-administrators"
                    >администратора</link> в базе данных могут изменить или удалить объект базы
                данных. Владелец базы данных, то есть пользователь, который создал её, имеет все
                права на объекты, которые были созданы другими пользователями.</para>

            <para>Администраторы или владелец объекта могут выдавать привилегии другим
                пользователям, в том числе и привилегии на право выдачи привилегий другим
                пользователям. Собственно сам процесс раздачи и отзыва привилегий на уровне SQL
                реализуется двумя операторами: <link linkend="security-priv-grant">GRANT</link>,
                    <link linkend="security-priv-revoke">REVOKE</link>.</para>
        </section>
        <section xml:id="security-priv-grant">
            <info>
                <title>GRANT</title>
                <keywordset>
                    <keyword>GRANT</keyword>
                </keywordset>
            </info>
            <indexterm><primary>GRANT</primary></indexterm>
            <formalpara>
                <title>Назначение:</title>

                <para>Предоставление привилегий или назначение ролей.</para>
            </formalpara>

            <formalpara>
                <title>Доступно в:</title>

                <para>DSQL.</para>
            </formalpara>
            <formalpara>
                <title>Синтаксис:</title>

                <para><programlisting>                    
<replaceable>&lt;grant_stmt&gt;</replaceable> ::= <replaceable>&lt;grant_priv_stmt&gt;</replaceable> | <replaceable>&lt;grant_roles_stmt&gt;</replaceable>

<replaceable>&lt;grant_priv_stmt&gt;</replaceable> ::= 
  GRANT <replaceable>&lt;privileges&gt;</replaceable> 
  TO {
      <replaceable>&lt;object_list&gt;</replaceable> 
    | PUBLIC 
    | <replaceable>&lt;user_list&gt;</replaceable> [WITH GRANT OPTION] 
    | SYSTEM PRIVILEGE <replaceable>&lt;sys_privileges_list&gt;</replaceable>
  } [{GRANTED BY | AS} [USER] <replaceable>grantor</replaceable>] 
  
<replaceable>&lt;grant_roles_stmt&gt;</replaceable> ::= 
  GRANT [DEFAULT] <replaceable>&lt;role_granted&gt;</replaceable> 
  TO { PUBLIC | <replaceable>&lt;role_grantee_list&gt;</replaceable> [WITH ADMIN OPTION] } 
  [{GRANTED BY | AS} [USER] <replaceable>grantor</replaceable>]

<replaceable>&lt;privileges&gt;</replaceable> ::= 
    <replaceable>&lt;table_privileges&gt;</replaceable>
  | <replaceable>&lt;execute_privileges&gt;</replaceable>
  | <replaceable>&lt;usage_privileges&gt;</replaceable>
  | <replaceable>&lt;ddl_privileges&gt;</replaceable>    
  | <replaceable>&lt;ddl_db_privileges&gt;</replaceable>           

<replaceable>&lt;table_privileges&gt;</replaceable> ::= 
  { ALL [PRIVILEGES] | <replaceable>&lt;table_privileges_list&gt;</replaceable> } 
  ON [TABLE] {<replaceable>table_name</replaceable> | <replaceable>view_name</replaceable>} 

<replaceable>&lt;table_privilege_list&gt;</replaceable> ::= {     
    SELECT 
  | DELETE 
  | INSERT 
  | UPDATE [(<replaceable>col</replaceable> [,<replaceable>col</replaceable> ...])] 
  | REFERENCES [(<replaceable>col</replaceable> [,<replaceable>col</replaceable> ...])]   
} [, <replaceable>&lt;table_privilege_list&gt;</replaceable> ...]    

<replaceable>&lt;execute_privileges&gt;</replaceable> ::= EXECUTE ON {
    PROCEDURE <replaceable>proc_name</replaceable>
  | FUNCTION <replaceable>func_name</replaceable>
  | PACKAGE <replaceable>package_name</replaceable>
}     

<replaceable>&lt;usage_privileges&gt;</replaceable> ::= USAGE ON {
    EXCEPTION <replaceable>exception_name</replaceable> 
  | {GENERATOR | SEQUENCE} <replaceable>generator_name</replaceable> 
}      

<replaceable>&lt;ddl_privileges&gt;</replaceable> ::= 
    {ALL [PRIVILEGES] | <replaceable>&lt;ddl_privelege&gt;</replaceable> [,<replaceable>&lt;ddl_privelege&gt;</replaceable> ...]} <replaceable>&lt;object_type&gt;</replaceable>

<replaceable>&lt;ddl_privelege&gt;</replaceable> ::= {CREATE | ALTER ANY | DROP ANY}

<replaceable>&lt;ddl_db_privileges&gt;</replaceable> ::= 
    {ALL [PRIVILEGES] | <replaceable>&lt;ddl_db_priv&gt;</replaceable> [,<replaceable>&lt;ddl_db_priv&gt;</replaceable> ...]} DATABASE

<replaceable>&lt;ddl_db_priv&gt;</replaceable> ::= {CREATE | ALTER | DROP}  
  
<replaceable>&lt;object_type&gt;</replaceable> ::= {
    CHARACTER SET 
  | COLLATION 
  | DOMAIN 
  | EXCEPTION 
  | FILTER 
  | FUNCTION 
  | GENERATOR 
  | PACKAGE 
  | PROCEDURE 
  | ROLE 
  | SEQUENCE 
  | TABLE 
  | VIEW
}  

<replaceable>&lt;sys_privileges_list&gt;</replaceable> ::= <replaceable>&lt;sys_privilege&gt;</replaceable> [, <replaceable>&lt;sys_privilege&gt;</replaceable> [, <replaceable>&lt;sys_privilege&gt;</replaceable> ...]] 

<replaceable>&lt;object_list&gt;</replaceable> ::= {     
    PROCEDURE <replaceable>proc_name</replaceable> 
  | FUNCTION <replaceable>func_name</replaceable>
  | PACKAGE <replaceable>package_name</replaceable>
  | TRIGGER <replaceable>trig_name</replaceable> 
  | VIEW <replaceable>view_name</replaceable> } [, <replaceable>&lt;object_list&gt;</replaceable> ...]

<replaceable>&lt;user_list&gt;</replaceable> ::= { 
    [USER] <replaceable>username</replaceable> 
  | [ROLE] <replaceable>rolename</replaceable> 
  | GROUP <replaceable>Unix_group</replaceable> 
  | <replaceable>Unix_user</replaceable> } [, <replaceable>&lt;user_list&gt;</replaceable> ...] 

<replaceable>&lt;role_granted&gt;</replaceable> ::= <replaceable>rolename</replaceable> [, <replaceable>rolename</replaceable> ...]

<replaceable>&lt;role_grantee_list&gt;</replaceable> ::= <replaceable>&lt;role_grantee_item&gt;</replaceable> [, <replaceable>&lt;role_grantee_item&gt;</replaceable> ...]      

<replaceable>&lt;role_grantee_item&gt;</replaceable> ::= [USER] <replaceable>username</replaceable> | [ROLE] <replaceable>rolename</replaceable>           
           </programlisting></para>
            </formalpara>

            <para>
                <table frame="all">
                    <title>Параметры оператора GRANT</title>
                    <?dbfo keep-together='auto'?>
                    <tgroup cols="2">
                        <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                        <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                        <thead>
                            <row>
                                <entry align="center">Параметр</entry>
                                <entry align="center">Описание</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry><replaceable>table_name</replaceable></entry>
                                <entry>
                                    <para>Имя таблицы, к которой должно быть применена привилегия.
                                    </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>view_name</replaceable></entry>
                                <entry>
                                    <para>Имя представления, к которому должно быть применена
                                        привилегия или которому будут выданы привилегии. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>col</replaceable></entry>
                                <entry>
                                    <para>Столбец таблицы, к которому должна быть применена
                                        привилегия. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>proc_name</replaceable></entry>
                                <entry>
                                    <para>Имя хранимой процедуры, для которой должна быть выдана
                                        привилегия EXECUTE или которой будут даны привилегии.
                                    </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>func_name</replaceable></entry>
                                <entry>
                                    <para>Имя хранимой функции (или UDF), для которой должна быть
                                        выдана привилегия EXECUTE или которой будут даны привилегии.
                                    </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>package_name</replaceable></entry>
                                <entry>
                                    <para>Имя пакета, для которого должна быть выдана привилегия
                                        EXECUTE или которому будут даны привилегии. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>exception_name</replaceable></entry>
                                <entry>
                                    <para>Имя исключения, для которого должна быть выдана привилегия
                                        USAGE.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>generator_name</replaceable></entry>
                                <entry>
                                    <para>Имя генератора (последовательности), для которого должна
                                        быть выдана привилегия USAGE.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>object_type</replaceable></entry>
                                <entry>
                                    <para>Тип объекта метаданных.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>object_list</replaceable></entry>
                                <entry>
                                    <para>Список объектов метаданных, которым будут даны
                                        привилегии.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>trig_name</replaceable></entry>
                                <entry>
                                    <para>Имя триггера, которому будут даны привилегии.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>user_list</replaceable>
                                </entry>
                                <entry>
                                    <para>Список пользователей/ролей, которым будут выданы
                                        привилегии.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>username</replaceable></entry>
                                <entry>
                                    <para>Имя пользователя, для которого выдаются привилегии или
                                        которому назначается роль. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>rolename</replaceable></entry>
                                <entry>
                                    <para>Имя роли.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>Unix_group</replaceable></entry>
                                <entry>
                                    <para>Имя группы пользователей в операционных системах семейства
                                        UNIX. Только в Firebird Embedded.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>Unix_user</replaceable></entry>
                                <entry>
                                    <para>Имя пользователя в операционной системе семейства UNIX.
                                        Только в Firebird Embedded.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>sys_privilege</replaceable></entry>
                                <entry>Системная привилегия.</entry>
                            </row>
                            <row>
                                <entry><replaceable>role_granted</replaceable></entry>
                                <entry>
                                    <para>Список ролей, которые будут назначены. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>role_grantee_list</replaceable></entry>
                                <entry>
                                    <para>Список пользователей, которым будут назначены роли.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>grantor</replaceable></entry>
                                <entry>
                                    <para>Пользователь от имени, которого предоставляются
                                        привилегии. </para>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>

            <para>Оператор GRANT предоставляет одну или несколько привилегий для объектов базы
                данных пользователям, ролям, хранимым процедурам, функциям, пакетам, триггерам и
                представлениям. </para>
            <para>Авторизованный пользователь не имеет никаких привилегий до тех пор, пока какие
                либо права не будут предоставлены ему явно. При создании объекта только его
                создатель и SYSDBA имеет привилегии на него и может назначать привилегии другим
                пользователям, ролям или объектам.</para>
            <para>Для различных типов объектов метаданных существует различный набор привилегий. Эти
                привилегии будут описаны далее отдельно для каждого из типов объектов
                метаданных.</para>
            <section xml:id="security-priv-grant-to_clause">
                <title>Предложение TO</title>
                <para>В предложении TO указывается список пользователей, ролей и объектов базы
                    данных (процедур, функций, пакетов, триггеров и представлений) для которых будут
                    выданы перечисленные привилегии. Необязательные предложения USER и ROLE
                    позволяют уточнить, кому именно выдаётся привилегия. Если ключевое слово USER
                    или ROLE не указано, то сервер проверяет, существует ли роль с данным именем,
                    если таковой не существует, то привилегии назначаются пользователю.
                    Существование пользователя, которому выдаются права, не проверяются при
                    выполнении оператора GRANT. Если привилегия выдаётся объекту базы данных, то
                    необходимо обязательно указывать тип объекта.</para>
                <tip>
                    <title>Рекомендация</title>
                    <para>Несмотря на то, что ключевые слова USER и ROLE не обязательные, желательно
                        использовать их, чтобы избежать путаницы. </para>
                </tip>
            </section>
            <section xml:id="security-priv-grant-public_user">
                <title>Пользователь PUBLIC</title>
                <para>В SQL существует специальный пользователь PUBLIC, представляющий всех
                    пользователей. Если какая-то операция разрешена пользователю PUBLIC, значит,
                    любой аутентифицированный пользователь может выполнить эту операцию над
                    указанным объектом.</para>
                <important>
                    <para>Если привилегии назначены пользователю PUBLIC, то и отозваны они должны
                        быть у пользователя PUBLIC.</para>
                </important>
            </section>
            <section xml:id="security-priv-grant-grant_option">
                <title>WITH GRANT OPTION</title>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>WITH GRANT OPTION</secondary>
                </indexterm>
                <para>Необязательное предложение WITH GRANT OPTION позволяет пользователям,
                    указанным в списке пользователей, передавать другим пользователям привилегии
                    указанные в списке привилегий.</para>
            </section>
            <section xml:id="security-priv-grant-granted_by">
                <title>GRANTED BY</title>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>GRANTED BY</secondary>
                </indexterm>
                <para>При предоставлении прав в базе данных в качестве лица, предоставившего эти
                    права, обычно записывается текущий пользователь. Используя предложение GRANTED
                    BY можно предоставлять права от имени другого пользователя. При использовании
                    оператора REVOKE после GRANTED BY права будут удалены только в том случае, если
                    они были зарегистрированы от удаляющего пользователя. Для облегчения миграции из
                    некоторых других реляционных СУБД нестандартное предложение AS поддерживается
                    как синоним оператора GRANTED BY.</para>
                <para>Предложение GRANTED BY может использовать: <itemizedlist spacing="compact">
                        <listitem>
                            <para>Владелец базы данных;</para>
                        </listitem>
                        <listitem>
                            <para>SYSDBA;</para>
                        </listitem>
                        <listitem>
                            <para>Любой пользователь, имеющий права на роль RDB$ADMIN и указавший её
                                при соединении с базой данных;</para>
                        </listitem>
                        <listitem>
                            <para>При использовании флага AUTO ADMIN MAPPING — любой администратор
                                операционной системы Windows (при условии использования сервером
                                доверенной авторизации — trusted authentication), даже без указания
                                роли.</para>
                        </listitem>
                    </itemizedlist></para>
                <para>Даже владелец роли не может использовать GRANTED BY, если он не находится в
                    вышеупомянутом списке.</para>
            </section>

            <section xml:id="security-priv-grant-table">
                <info>
                    <title>Табличные привилегии</title>
                    <keywordset>
                        <keyword>GRANT SELECT</keyword>
                        <keyword>GRANT INSERT</keyword>
                        <keyword>GRANT UPDATE</keyword>
                        <keyword>GRANT DELETE</keyword>
                        <keyword>GRANT REFERENCES</keyword>
                        <keyword>GRANT ALL</keyword>
                    </keywordset>
                </info>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>SELECT</secondary>
                </indexterm>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>INSERT</secondary>
                </indexterm>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>UPDATE</secondary>
                </indexterm>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>DELETE</secondary>
                </indexterm>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>REFERENCES</secondary>
                </indexterm>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>ALL</secondary>
                </indexterm>
                <para>Для таблиц и представлений в отличие от других объектов метаданных возможно
                    использовании сразу нескольких привилегий.</para>
                <para>
                    <table frame="all">
                        <title>Список привилегий для таблиц</title>
                        <?dbfo keep-together='auto'?>
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1" colwidth="1*" align="left"/>
                            <colspec colname="c2" colnum="2" colwidth="3*" align="justify"/>
                            <thead>
                                <row>
                                    <entry align="center">Привилегия</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry>SELECT</entry>
                                    <entry>
                                        <para>Разрешает выборку данных из таблицы или представления.
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>INSERT</entry>
                                    <entry>
                                        <para>Разрешает добавлять записи в таблицу или
                                            представление. </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>UPDATE</entry>
                                    <entry>
                                        <para>Разрешает изменять записи в таблице или представлении.
                                            Можно указать ограничения, чтобы можно было изменять
                                            только указанные столбцы. </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>DELETE</entry>
                                    <entry>
                                        <para>Разрешает удалять записи из таблицы или представления.
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>REFERENCES</entry>
                                    <entry>
                                        <para>Разрешает ссылаться на указанные столбцы внешним
                                            ключом. Необходимо указать для столбцов, на которых
                                            построен первичный ключ таблицы, если на неё есть ссылка
                                            внешним ключом другой таблицы. </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>ALL</entry>
                                    <entry>
                                        <para>Объединяет привилегии SELECT, INSERT, UPDATE, DELETE и
                                            REFERENCES. </para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Назначение привилегий для таблиц</title>
                            <para>
                                <programlisting language="sql">
-- Привилегии SELECT, INSERT пользователю ALEX                            
GRANT SELECT, INSERT ON TABLE SALES 
TO USER ALEX;

-- Привилегия SELECT ролям MANAGER, ENGINEER и пользователю IVAN
GRANT SELECT ON TABLE CUSTOMER 
TO ROLE MANAGER, ROLE ENGINEER, USER IVAN;

-- Все привилегии для роли ADMINISTRATOR 
-- с возможностью передачи своих полномочий
GRANT ALL ON TABLE CUSTOMER 
TO ROLE ADMINISTRATOR WITH GRANT OPTION;

-- Привилегии SELECT и REFRENCE для столбца NAME для всех пользователей
GRANT SELECT, REFERENCES (NAME) ON TABLE COUNTRY 
TO PUBLIC;

-- Выдача привилегии SELECT для пользователя IVAN от имени пользователя ALEX 
GRANT SELECT ON TABLE EMPLOYEE 
TO USER IVAN GRANTED BY ALEX;

-- Привилегия UPDATE для столбцов FIRST_NAME, LAST_NAME
GRANT UPDATE (FIRST_NAME, LAST_NAME) ON TABLE EMPLOYEE 
TO USER IVAN;

-- Привилегия INSERT для хранимой процедуры ADD_EMP_PROJ
GRANT INSERT ON EMPLOYEE_PROJECT 
TO PROCEDURE ADD_EMP_PROJ;
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>
            </section>
            <section xml:id="security-priv-grant-execute">
                <info>
                    <title>Привилегия EXECUTE</title>
                    <keywordset>
                        <keyword>GRANT EXECUTE</keyword>
                    </keywordset>
                </info>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>EXECUTE</secondary>
                </indexterm>
                <para>Привилегия EXECUTE (выполнение) применима к хранимым процедурам, хранимым
                    функциям, пакетам и унаследованным внешним функциям (UDF), определяемых как
                    DECLARE EXTERNAL FUNCTION.</para>
                <para>Для хранимых процедур привилегия EXECUTE позволяет не только выполнять
                    хранимые процедуры, но и делать выборку данных из селективных процедур (с
                    помощью оператора SELECT).</para>
                <note>
                    <title>Замечание:</title>
                    <para>Привилегия может быть назначена только для всего пакета, а не для
                        отдельных его подпрограмм.</para>
                </note>

                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Назначение привилегии EXECUTE</title>
                            <para>
                                <programlisting language="sql">
-- Привилегия EXECUTE на хранимую процедуру                             
GRANT EXECUTE ON PROCEDURE ADD_EMP_PROJ 
TO ROLE MANAGER;

-- Привилегия EXECUTE на хранимую функцию 
GRANT EXECUTE ON FUNCTION GET_BEGIN_DATE TO ROLE MANAGER;

-- Привилегия EXECUTE на пакет
GRANT EXECUTE ON PACKAGE APP_VAR TO PUBLIC;

-- Привилегия EXECUTE на функцию выданная пакету
GRANT EXECUTE ON FUNCTION GET_BEGIN_DATE
TO PACKAGE APP_VAR;
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>
            </section>
            <section xml:id="security-priv-grant-usage">
                <info>
                    <title>Привилегия USAGE</title>
                    <keywordset>
                        <keyword>GRANT USAGE</keyword>
                    </keywordset>
                </info>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>USAGE</secondary>
                </indexterm>
                <para> Для использования объектов метаданных, отличных от таблиц, представлений,
                    хранимых процедур и функций, триггеров и пакетов, в пользовательских запросах
                    необходимо предоставить пользователю привилегию USAGE для этих объектов.
                    Поскольку в Firebird хранимые процедуры и функции, триггеры и подпрограммы
                    пакетов выполняются с привилегиями вызывающего пользователя, то при
                    использовании таких объектов метаданных в них, может потребоваться назначить
                    привилегию USAGE и для них. </para>
                <note>
                    <title>Замечание:</title>
                    <para> В Firebird 3 привилегия USAGE проверяется только для исключений
                        (exception) и генераторов/последовательностей (в
                            gen_id(<replaceable>gen_name</replaceable>, 1) или next value for
                            <replaceable>gen_name</replaceable>). Привилегии для других объектов
                        метаданных могут быть включены в следующих релизах, если покажется
                        целесообразным. </para>
                </note>
                <note>
                    <title>Замечание:</title>
                    <para> Привилегия USAGE даёт права только на приращения генераторов
                        (последовательностей) с помощью функции GEN_ID или конструкции NEXT VALUE
                        FOR. Оператор SET GENERATOR является аналогом оператора ALTER SEQUENCE ...
                        RESTART WITH, которые относятся к DDL операторам. По умолчанию права на
                        такие операции имеет только владелец генератора (последовательности). Права
                        на установку начального значения любого генератора (последовательности)
                        можно предоставить с помощью GRANT ALTER ANY SEQUENCE, что не рекомендуется
                        для обычных пользователей. </para>
                </note>

                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Назначение привилегии USAGE</title>
                            <para>
                                <programlisting language="sql">
-- Привилегия USAGE на последовательность выданная роли                            
GRANT USAGE ON SEQUENCE GEN_AGE TO ROLE MANAGER;

-- Привилегия USAGE на последовательность выданная триггеру   
GRANT USAGE ON SEQUENCE GEN_AGE TO TRIGGER TR_AGE_BI;

-- Привилегия USAGE на исключение выданная пакету
GRANT USAGE ON EXCEPTION E_ACCESS_DENIED
TO PACKAGE PKG_BILL;
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>
            </section>

            <section xml:id="security-priv-grant-ddl">
                <info>
                    <title>DDL привилегии</title>
                    <keywordset>
                        <keyword>GRANT CREATE</keyword>
                        <keyword>GRANT ALTER ANY</keyword>
                        <keyword>GRANT DROP ANY</keyword>
                    </keywordset>
                </info>
                <para>По умолчанию создавать новые объекты метаданных могут только <link
                        linkend="security-administrators">Администраторы</link>, а изменять и
                    удалять — администраторы и владельцы этих объектов. Выдача привилегий на
                    создание, изменение или удаление объектов конкретного типа позволяет расширить
                    этот список.</para>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>CREATE</secondary>
                </indexterm>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>ALTER ANY</secondary>
                </indexterm>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>DROP ANY</secondary>
                </indexterm>

                <para>
                    <table frame="all">
                        <title>Список DDL привилегий</title>
                        <?dbfo keep-together='auto'?>
                        <tgroup cols="2">
                            <colspec colname="c1" colnum="1" colwidth="1*" align="left"/>
                            <colspec colname="c2" colnum="2" colwidth="3*" align="justify"/>
                            <thead>
                                <row>
                                    <entry align="center">Привилегия</entry>
                                    <entry align="center">Описание</entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry>CREATE</entry>
                                    <entry>
                                        <para>Разрешает создание объекта указанного типа метаданных.
                                        </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>ALTER ANY</entry>
                                    <entry>
                                        <para>Разрешает изменение любого объекта указанного типа
                                            метаданных. </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>DROP ANY</entry>
                                    <entry>
                                        <para>Разрешает удаление любого объекта указанного типа
                                            метаданных. </para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>ALL</entry>
                                    <entry>
                                        <para>Объединяет привилегии CREATE, ALTER и DROP на
                                            указанный тип объекта. </para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </para>

                <note>
                    <title>Примечание:</title>
                    <para>Метаданные триггеров и индексов наследуют привилегии таблиц, которые
                        владеют ими.</para>
                </note>

                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Назначение привилегий на изменение метаданных</title>
                            <para>
                                <programlisting language="sql">
-- Разрешение пользователю Joe создавать таблицы                            
GRANT CREATE TABLE TO Joe;

-- Разрешение пользователю Joe изменять любые процедуры
GRANT ALTER ANY PROCEDURE TO Joe;
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>

                <section xml:id="security-priv-grant-ddl-database">
                    <info>
                        <title>DDL привилегии на базу данных</title>
                        <keywordset>
                            <keyword>GRANT CREATE DATABASE</keyword>
                            <keyword>GRANT ALTER DATABASE</keyword>
                            <keyword>GRANT DROP DATABASE</keyword>
                        </keywordset>
                    </info>
                    <indexterm>
                        <primary>GRANT</primary>
                        <secondary>CREATE DATABASE</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>GRANT</primary>
                        <secondary>ALTER DATABASE</secondary>
                    </indexterm>
                    <indexterm>
                        <primary>GRANT</primary>
                        <secondary>DROP DATABASE</secondary>
                    </indexterm>

                    <para>Оператор назначения привилегий на создание, удаление и изменение базы
                        данных имеет несколько отличную форму от оператора назначения DDL привилегий
                        на другие объекты метаданных.</para>

                    <para>
                        <table frame="all">
                            <title>Список DDL привилегий на базу данных</title>
                            <?dbfo keep-together='auto'?>
                            <tgroup cols="2">
                                <colspec colname="c1" colnum="1" colwidth="1*" align="left"/>
                                <colspec colname="c2" colnum="2" colwidth="3*" align="justify"/>
                                <thead>
                                    <row>
                                        <entry align="center">Привилегия</entry>
                                        <entry align="center">Описание</entry>
                                    </row>
                                </thead>
                                <tbody>
                                    <row>
                                        <entry>CREATE</entry>
                                        <entry>
                                            <para>Разрешает создание базы данных. </para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>ALTER</entry>
                                        <entry>
                                            <para>Разрешает изменение текущей базы данных. </para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>DROP</entry>
                                        <entry>
                                            <para>Разрешает удаление текущей базы данных. </para>
                                        </entry>
                                    </row>
                                    <row>
                                        <entry>ALL</entry>
                                        <entry>
                                            <para>Объединяет привилегии ALTER и DROP на базу данных.
                                            </para>
                                        </entry>
                                    </row>
                                </tbody>
                            </tgroup>
                        </table>
                    </para>

                    <para>Привилегия CREATE DATABASE является особым видом привилегий, поскольку она
                        сохраняется в базе данных безопасности. Список пользователей имеющих
                        привилегию CREATE DATABASE можно посмотреть в виртуальной таблице
                        SEC$DB_CREATORS. Привилегию на создание новой базы данных могут выдавать
                        только <link linkend="security-administrators">Администраторы</link> в базе
                        данных безопасности.</para>
                    <para>Привилегии ALTER DATABASE и DROP DATABASE относятся только к текущей базе
                        данных, тогда как DDL привилегии ALTER ANY и DROP ANY на другие объекты
                        метаданных относятся ко всем объектам указанного типа внутри текущей базы
                        данных. Привилегии на изменение и удаление текущей базы данных могут
                        выдавать только <link linkend="security-administrators"
                            >Администраторы</link>.</para>

                    <formalpara>
                        <title>Примеры:</title>

                        <para>
                            <informalexample>
                                <para>
                                    <programlisting language="sql">
-- Разрешение пользователю Superuser создавать базы данных                            
GRANT CREATE DATABASE TO USER Superuser;

-- Разрешение пользователю Joe выполнять оператор ALTER DATABASE 
-- для текущей базы данных
GRANT ALTER DATABASE TO USER Joe;

-- Разрешение пользователю Fedor удалять текущую базу данных
GRANT DROP DATABASE TO USER Fedor;
                </programlisting>
                                </para>
                            </informalexample>
                        </para>
                    </formalpara>
                </section>
            </section>
            <section xml:id="security-priv-grant-sys_priv">
                <info>
                    <title>Выдача прав системным привилегиям</title>
                    <keywordset>
                        <keyword>SYSTEM PRIVILEGE</keyword>
                    </keywordset>
                </info>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>SYSTEM PRIVILEGE</secondary>
                </indexterm>
                <para>Благодаря поддержки системных привилегий в ядре, становится очень удобно
                    предоставлять некоторые дополнительные привилегии пользователям уже имеющим
                    какую-то системную привилегию. Для этих целей существует возможность
                    использовать в качестве грантополучателя одну или несколько системных
                    привилегий.</para>
                <formalpara>
                    <title>Пример:</title>

                    <para>
                        <informalexample>
                            <para>Следующий оператор назначит все привилегии на представление
                                PLG$SRP_VIEW, используемое в плагине управления пользователями SRP,
                                системной привилегии USER_MANAGEMENT.
                                <programlisting language="sql">
GRANT ALL ON PLG$SRP_VIEW TO SYSTEM PRIVILEGE USER_MANAGEMENT
                </programlisting>
                            </para>
                        </informalexample>
                    </para>
                </formalpara>
                <para>Описание системных привилегий вы можете посмотреть в <link
                        linkend="security-roles-create">CREATE ROLE</link></para>
            </section>
            <section xml:id="security-priv-grant-role">
                <title>Назначение ролей</title>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>ROLE</secondary>
                </indexterm>
                
                <formalpara>
                    <title>Синтаксис:</title>
                    
                    <para><programlisting>   
<replaceable>&lt;grant_roles_stmt&gt;</replaceable> ::= 
  GRANT [DEFAULT] <replaceable>&lt;role_granted&gt;</replaceable> 
  TO { PUBLIC | <replaceable>&lt;role_grantee_list&gt;</replaceable> [WITH ADMIN OPTION] } 
  [{GRANTED BY | AS} [USER] <replaceable>grantor</replaceable>] 
                        
<replaceable>&lt;role_granted&gt;</replaceable> ::= <replaceable>rolename</replaceable> [, <replaceable>rolename</replaceable> ...]  
                        
<replaceable>&lt;role_grantee_list&gt;</replaceable> ::= <replaceable>&lt;role_grantee_item&gt;</replaceable> [, <replaceable>&lt;role_grantee_item&gt;</replaceable> ...]      

<replaceable>&lt;role_grantee_item&gt;</replaceable> ::= [USER] <replaceable>username</replaceable> | [ROLE] <replaceable>rolename</replaceable>                           
</programlisting></para>
                </formalpara>
                
                <para>Оператор <database>GRANT</database> может быть использован для назначения
                    ролей для списка пользователей или ролей. В этом случае после предложения GRANT
                    следует список ролей, которые будут назначены списку пользователей или ролей,
                    указанному после предложения TO. </para>
                <para>Если используется ключевое слово <database>DEFAULT</database>, то роль (роли)
                    будет использоваться пользователем или ролью каждый раз, даже если она не была
                    указана явно. При подключении пользователь получит привилегии всех ролей,
                    которые были назначены пользователю с использованием ключевого слова
                        <database>DEFAULT</database>. Если пользователь укажет свою роль при
                    подключении, то получит привилегии этой роли (если она была ему назначена) и
                    привилегии всех ролей назначенных ему с использованием ключевого слова
                        <database>DEFAULT</database>.</para>
                <indexterm>
                    <primary>GRANT</primary>
                    <secondary>ROLE</secondary>
                    <tertiary>WITH ADMIN OPTION</tertiary>
                </indexterm>
                <para>Необязательное предложение <database>WITH ADMIN OPTION</database> позволяет
                    пользователям, указанным в списке пользователей, передавать свои роли другому
                    пользователю или роли. Полномочия роли могут быть переданы кумулятивно, только
                    если каждая роль в последовательности ролей назначена с использованием
                        <database>WITH ADMIN OPTION</database>.</para>

                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Назначение ролей для пользователей</title>
                            <para>
                                <programlisting language="sql">
-- Назначение ролей DIRECTOR и MANAGER пользователю IVAN                            
GRANT DIRECTOR, MANAGER TO USER IVAN;

-- Назначение роли ADMIN пользователю ALEX 
-- с возможностью назначить эту другим пользователям
GRANT MANAGER TO USER ALEX WITH ADMIN OPTION;

-- Назначение роли MANAGER пользователю JOHN
-- Привилегии роли будут автоматически назначаться пользователю
-- каждый раз при входе. В этом случае роль выступает в качестве группы.
GRANT DEFAULT MANAGER TO USER JOHN;

-- Теперь при входе пользователь JOHN автоматически получит привилегии
-- ролей MANAGER (см. предыдущий оператор) и DIRECTOR
GRANT DEFAULT DIRECTOR TO USER JOHN;
                </programlisting>
                            </para>
                        </example>
                        <example>
                            <title>Назначение ролей другим ролям</title>
                            <para>
                                <programlisting language="sql">
-- Назначение роли MANAGER для роли DIRECTOR 
-- с возможностью передачи роли MANAGER другим пользователям или ролям
GRANT MANAGER TO ROLE DIRECTOR WITH ADMIN OPTION;

-- Назначение роли ACCOUNTANT роли DIRECTOR
-- при входе в систему с ролью DIRECTOR полномочия роли ACCOUNTANT
-- будут также получены
GRANT DEFAULT ACCOUNTANT TO ROLE DIRECTOR;
     
-- Пользователь PETROV при входе автоматически получает
-- полномочия роли DIRECTOR. Эти полномочия будут включать также
-- полномочия роли ACCOUNTANT. Для получения полномочий роли MANAGER
-- необходимо указать эту роль при входе в систему или позже с 
-- помощью оператора SET ROLE          
GRANT DEFAULT ROLE DIRECTOR TO USER PETROV;

  </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>

                <formalpara>
                    <title>См. также:</title>

                    <para>
                        <link linkend="security-priv-revoke">REVOKE</link>. </para>
                </formalpara>
            </section>
        </section>
        <section xml:id="security-priv-revoke">
            <info>
                <title>REVOKE</title>
                <keywordset>
                    <keyword>REVOKE</keyword>
                </keywordset>
            </info>
            <indexterm><primary>REVOKE</primary></indexterm>
            <formalpara>
                <title>Назначение:</title>

                <para>Отмена привилегий или отбор ролей.</para>
            </formalpara>

            <formalpara>
                <title>Доступно в:</title>

                <para>DSQL.</para>
            </formalpara>
            <formalpara>
                <title>Синтаксис:</title>

                <para><programlisting>                    
<replaceable>&lt;revoke_stmt&gt;</replaceable> ::= 
    <replaceable>&lt;revoke_priv_stmt&gt;</replaceable> 
  | <replaceable>&lt;revoke_role_stmt&gt;</replaceable> 
  | <replaceable>&lt;revoke_all_stmt&gt;</replaceable>

<replaceable>&lt;revoke_priv_stmt&gt;</replaceable> ::= 
  REVOKE [GRANT OPTION FOR] <replaceable>&lt;privileges&gt;</replaceable> 
  FROM {
      <replaceable>&lt;object_list&gt;</replaceable> 
    | PUBLIC | 
    | <replaceable>&lt;user_list&gt;</replaceable> 
    | SYSTEM PRIVILEGE <replaceable>&lt;sys_privileges_list&gt;</replaceable> } 
  [{GRANTED BY | AS} [USER] <replaceable>grantor</replaceable>] 

<replaceable>&lt;revoke_role_stmt&gt;</replaceable> ::= 
  REVOKE [ADMIN OPTION FOR] [DEFAULT] <replaceable>&lt;role_granted&gt;</replaceable> 
  FROM {PUBLIC | <replaceable>&lt;role_grantee_list&gt;</replaceable> } 
  [{GRANTED BY | AS} [USER] <replaceable>grantor</replaceable>] 

<replaceable>&lt;revoke_all_stmt&gt;</replaceable> ::= 
  REVOKE ALL ON ALL FROM <replaceable>&lt;user_list&gt;</replaceable>
  [{GRANTED BY | AS} [USER] <replaceable>grantor</replaceable>] 

<replaceable>&lt;privileges&gt;</replaceable> ::= 
    <replaceable>&lt;table_privileges&gt;</replaceable>
  | <replaceable>&lt;execute_privileges&gt;</replaceable>
  | <replaceable>&lt;usage_privileges&gt;</replaceable>
  | <replaceable>&lt;ddl_privileges&gt;</replaceable>  
  | <replaceable>&lt;ddl_db_privileges&gt;</replaceable>            

<replaceable>&lt;table_privileges&gt;</replaceable> ::= 
  { ALL [PRIVILEGES] | <replaceable>&lt;table_privileges_list&gt;</replaceable> } 
  ON [TABLE] {<replaceable>table_name</replaceable> | <replaceable>view_name</replaceable>} 

<replaceable>&lt;table_privilege_list&gt;</replaceable> ::= {     
    SELECT 
  | DELETE 
  | INSERT 
  | UPDATE [(<replaceable>col</replaceable> [,<replaceable>col</replaceable> ...])] 
  | REFERENCES [(<replaceable>col</replaceable> [,<replaceable>col</replaceable> ...])]   
} [, <replaceable>&lt;table_privilege_list&gt;</replaceable> ...]    

<replaceable>&lt;execute_privileges&gt;</replaceable> ::= EXECUTE ON {
    PROCEDURE <replaceable>proc_name</replaceable>
  | FUNCTION <replaceable>func_name</replaceable>
  | PACKAGE <replaceable>package_name</replaceable>
}     

<replaceable>&lt;usage_privileges&gt;</replaceable> ::= USAGE ON {
    EXCEPTION <replaceable>exception_name</replaceable> 
  | {GENERATOR | SEQUENCE} <replaceable>generator_name</replaceable>
}      


<replaceable>&lt;ddl_privileges&gt;</replaceable> ::= 
    {ALL [PRIVILEGES] | <replaceable>&lt;ddl_privelege&gt;</replaceable> [,<replaceable>&lt;ddl_privelege&gt;</replaceable> ...]} <replaceable>&lt;object_type&gt;</replaceable>

<replaceable>&lt;ddl_privelege&gt;</replaceable> ::= CREATE | ALTER ANY | DROP ANY

  
<replaceable>&lt;ddl_db_privileges&gt;</replaceable> ::= 
    {ALL [PRIVILEGES] | <replaceable>&lt;ddl_db_priv&gt;</replaceable> [,<replaceable>&lt;ddl_db_priv&gt;</replaceable> ...]} DATABASE

<replaceable>&lt;ddl_db_priv&gt;</replaceable> ::= CREATE | ALTER | DROP  
  
<replaceable>&lt;object_type&gt;</replaceable> ::= 
    CHARACTER SET 
  | COLLATION 
  | DOMAIN 
  | EXCEPTION 
  | FILTER 
  | FUNCTION 
  | GENERATOR 
  | PACKAGE 
  | PROCEDURE 
  | ROLE 
  | SEQUENCE 
  | TABLE 
  | VIEW
  

<replaceable>&lt;object_list&gt;</replaceable> ::= {     
    PROCEDURE <replaceable>proc_name</replaceable> 
  | FUNCTION <replaceable>func_name</replaceable>
  | PACKAGE <replaceable>package_name</replaceable>
  | TRIGGER <replaceable>trig_name</replaceable> 
  | VIEW <replaceable>view_name</replaceable> } [, <replaceable>&lt;object_list&gt;</replaceable> ...]

<replaceable>&lt;sys_privileges_list&gt;</replaceable> ::= <replaceable>&lt;sys_privilege&gt;</replaceable> [, <replaceable>&lt;sys_privilege&gt;</replaceable> [, <replaceable>&lt;sys_privilege&gt;</replaceable> ...]] 

<replaceable>&lt;user_list&gt;</replaceable> ::= { 
    [USER] <replaceable>username</replaceable> 
  | [ROLE] <replaceable>rolename</replaceable> 
  | GROUP <replaceable>Unix_group</replaceable> 
  | <replaceable>Unix_user</replaceable> } [, <replaceable>&lt;user_list&gt;</replaceable> ...] 

<replaceable>&lt;role_granted&gt;</replaceable> ::= <replaceable>rolename</replaceable> [, <replaceable>rolename</replaceable> ...]

<replaceable>&lt;role_grantee_list&gt;</replaceable> ::= [USER] <replaceable>username</replaceable> [, [USER] <replaceable>username</replaceable> ...]               
           </programlisting></para>
            </formalpara>
            <para>
                <table frame="all">
                    <title>Параметры оператора REVOKE</title>
                    <?dbfo keep-together='auto'?>
                    <tgroup cols="2">
                        <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                        <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                        <thead>
                            <row>
                                <entry align="center">Параметр</entry>
                                <entry align="center">Описание</entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry><replaceable>table_name</replaceable></entry>
                                <entry>
                                    <para>Имя таблицы, у которой должна быть отозвана привилегия.
                                    </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>view_name</replaceable></entry>
                                <entry>
                                    <para>Имя представления, к которому должно быть применена
                                        привилегия или которого будет отозваны привилегии. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>col</replaceable></entry>
                                <entry>
                                    <para>Столбец таблицы, у которого должна быть отозвана
                                        привилегия. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>proc_name</replaceable></entry>
                                <entry>
                                    <para>Имя хранимой процедуры, для которой должна быть отозвана
                                        привилегия EXECUTE или у которой должны быть отозваны
                                        привилегии. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>func_name</replaceable></entry>
                                <entry>
                                    <para>Имя хранимой функции (или UDF), для которой должна быть
                                        отозвана привилегия EXECUTE или у которой должны быть
                                        отозваны привилегии. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>package_name</replaceable></entry>
                                <entry>
                                    <para>Имя пакета, для которого должна быть отозвана привилегия
                                        EXECUTE или у которого должны быть отозваны привилегии.
                                    </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>exception_name</replaceable></entry>
                                <entry>
                                    <para>Имя исключения, для которого должна быть отозвана
                                        привилегия USAGE.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>generator_name</replaceable></entry>
                                <entry>
                                    <para>Имя генератора (последовательности), для которого должна
                                        быть отозвана привилегия USAGE.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>object_type</replaceable></entry>
                                <entry>
                                    <para>Тип объекта метаданных.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>object_list</replaceable></entry>
                                <entry>
                                    <para>Список объектов метаданных, у которых будут отозваны
                                        привилегии.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>trig_name</replaceable></entry>
                                <entry>
                                    <para>Имя триггера, у которого будут отозваны привилегии.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>sys_privilege</replaceable></entry>
                                <entry>Системная привилегия.</entry>
                            </row>
                            <row>
                                <entry><replaceable>user_list</replaceable>
                                </entry>
                                <entry>
                                    <para>Список пользователей/ролей, у которых будут отозваны
                                        привилегии.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>username</replaceable></entry>
                                <entry>
                                    <para>Имя пользователя, для которого отзываются привилегии или у
                                        которого отбирается роль. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>rolename</replaceable></entry>
                                <entry>
                                    <para>Имя роли.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>Unix_group</replaceable></entry>
                                <entry>
                                    <para>Имя группы пользователей в операционных системах семейства
                                        UNIX. Только в Firebird Embedded.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>Unix_user</replaceable></entry>
                                <entry>
                                    <para>Имя пользователя в операционной системе семейства UNIX.
                                        Только в Firebird Embedded.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>role_granted</replaceable></entry>
                                <entry>
                                    <para>Список ролей, которые будут отобраны. </para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>role_grantee_list</replaceable></entry>
                                <entry>
                                    <para>Список пользователей, у которых будут отобраны
                                        роли.</para>
                                </entry>
                            </row>
                            <row>
                                <entry><replaceable>grantor</replaceable></entry>
                                <entry>
                                    <para>Пользователь от имени, которого отзываются привилегии.
                                    </para>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </para>

            <para>Оператор REVOKE отменяет привилегии для пользователей, ролей, хранимых процедур,
                хранимых функций, пакетов, триггеров и представлений выданные оператором GRANT.
                Подробное описание различных типов привилегий см. в <link
                    linkend="security-priv-grant">GRANT</link>. </para>
            <section xml:id="security-priv-revoke-from_clause">
                <title>Предложение FROM</title>
                <para>В предложении FROM указывается список пользователей, ролей и объектов базы
                    данных (процедур, функций, пакетов, триггеров и представлений) у которых будут
                    отняты перечисленные привилегии. Необязательные предложения USER и ROLE
                    позволяют уточнить, у кого именно выдаётся привилегия. Если ключевое слово USER
                    или ROLE не указано, то сервер проверяет, существует ли роль с данным именем,
                    если таковой не существует, то привилегии отбираются у пользователя.</para>
                <tip>
                    <title>Рекомендация</title>
                    <para>Несмотря на то, что ключевые слова USER и ROLE не обязательные, желательно
                        использовать их, чтобы избежать путаницы. </para>
                </tip>
                <para>Существование пользователя, у которого отбираются права, не проверяются при
                    выполнении оператора REVOKE. Если привилегия отбирается у объекта базы данных,
                    то необходимо обязательно указывать тип объекта.</para>
                <important>
                    <para>Если привилегии были назначены специальному пользователю PUBLIC, то
                        отменять привилегии необходимо для пользователя PUBLIC. Специальный
                        пользователь PUBLIC используется, когда необходимо предоставить привилегии
                        сразу всем пользователям. Однако не следует рассматривать PUBLIC как группу
                        пользователей.</para>
                </important>
                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Отзыв привилегий на таблицу</title>
                            <para>
                                <programlisting language="sql">
-- отзыв привилегий SELECT, INSERT у таблицы                        
REVOKE SELECT, INSERT ON TABLE SALES FROM USER ALEX

-- отзыв привилегии SELECT у ролей MANAGER и ENGINEER и пользователя IVAN
REVOKE SELECT ON TABLE CUSTOMER 
FROM ROLE MANAGER, ROLE ENGINEER, USER IVAN;

-- отзыв привилегий SELECT и REFERENCES у пользователя PUBLIC
REVOKE SELECT, REFERENCES (NAME) ON TABLE COUNTRY 
FROM PUBLIC;

-- отзыв привилегии UPDATE для столбцов FIRST_NAME, LAST_NAME 
REVOKE UPDATE (FIRST_NAME, LAST_NAME) ON TABLE EMPLOYEE 
FROM USER IVAN;

-- отзыв привилегии INSERT у хранимой процедуры ADD_EMP_PROJ
REVOKE INSERT ON EMPLOYEE_PROJECT 
FROM PROCEDURE ADD_EMP_PROJ;
                </programlisting>
                            </para>
                        </example>
                        <example>
                            <title>Отзыв привилегии EXECUTE</title>
                            <para>
                                <programlisting language="sql">
-- отзыв привилегии EXECUTE на процедуру                        
REVOKE EXECUTE ON PROCEDURE ADD_EMP_PROJ 
FROM USER IVAN;
       
-- отзыв привилегии EXECUTE на пакет
REVOKE EXECUTE ON PACKAGE DATE_UTILS
FROM USER ALEX;
                </programlisting>
                            </para>
                        </example>
                        <example>
                            <title>Отзыв привилегии USAGE</title>
                            <para>
                                <programlisting language="sql">
-- Отзыв привилегии USAGE на последовательность выданной роли                            
REVOKE USAGE ON SEQUENCE GEN_AGE FROM ROLE MANAGER;

-- Отзыв привилегии USAGE на последовательность выданной триггеру   
REVOKE USAGE ON SEQUENCE GEN_AGE FROM TRIGGER TR_AGE_BI;

-- Отзыв привилегии USAGE на исключение выданной пакету
REVOKE USAGE ON EXCEPTION E_ACCESS_DENIED
FROM PACKAGE PKG_BILL;
                </programlisting>
                            </para>
                        </example>
                        <example>
                            <title>Отзыв привилегий на изменение метаданных</title>
                            <para>
                                <programlisting language="sql">
-- Отзыв у пользователя Joe привилегии на создание таблиц                            
REVOKE CREATE TABLE FROM Joe;

-- Отзыв у пользователя Joe привилегии на изменение любой процедуры
REVOKE ALTER ANY PROCEDURE FROM Joe;

-- Отзыв привилегии пользователю на создание базы данных 
-- у пользователя Superuser                             
REVOKE CREATE DATABASE FROM USER Superuser;
                </programlisting>
                            </para>
                        </example>
                        <example>
                            <title>Отзыв привилегий у системной привилегии</title>
                            <para>
                                <programlisting language="sql">
-- Отзыв у системной привилегии USER_MANAGEMENT всех прав 
-- на представление PLG$SRP_VIEW                            
REVOKE ALL ON PLG$SRP_VIEW FROM SYSTEM PRIVILEGE USER_MANAGEMENT;
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>

            </section>
            <section xml:id="security-priv-revoke-grant_option">
                <title>GRANT OPTION FOR</title>
                <indexterm>
                    <primary>REVOKE</primary>
                    <secondary>GRANT OPTION FOR</secondary>
                </indexterm>
                <para>Необязательное предложение GRANT OPTION FOR отменяет для соответствующего
                    пользователя или роли право предоставления другим пользователям или ролям
                    привилегии к таблицам, представлениям, триггерам, хранимым процедурам.</para>
                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Отзыв привилегий с использованием GRANT OPTION FOR</title>
                            <para>
                                <programlisting language="sql">
-- отмена возможности передавать любую из привилегии на таблицу
-- другим пользователям или ролям у роли ADMINISTRATOR
REVOKE GRANT OPTION FOR ALL ON TABLE CUSTOMER 
FROM ROLE ADMINISTRATOR;

-- отзыв привилегии EXECUTE на функцию
-- и лишение права передавать эту привилегию 
-- другим пользователям и ролям
REVOKE GRANT OPTION FOR
EXECUTE ON FUNCTION GET_BEGIN_DATE
FROM ROLE MANAGER;
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>

            </section>
            <section xml:id="security-priv-revoke-roles">
                <title>Отмена назначенных ролей</title>
                <indexterm>
                    <primary>REVOKE</primary>
                    <secondary>ROLE</secondary>
                </indexterm>
                <para>Другое назначение оператора REVOKE в отзыве назначенных пользователям или
                    ролям ролей оператором GRANT. В этом случае после предложения REVOKE следует
                    список ролей, которые будут отозваны у списка пользователей или ролей, указанных
                    после предложения FROM. </para>
                <indexterm>
                    <primary>REVOKE</primary>
                    <secondary>ROLE</secondary>
                    <tertiary>ADMIN OPTION FOR</tertiary>
                </indexterm>
                <para>Необязательное предложение ADMIN OPTION FOR отменяет ранее предоставленную
                    административную опцию (право на передачу предоставленной пользователю роли
                    другим) из грантополучателей, не отменяя прав на роль. В одном операторе могут
                    быть обработаны несколько ролей и/или грантополучателей.</para>
                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Отзыв ролей</title>
                            <para>
                                <programlisting language="sql">
-- Отзыв ролей DIRECTOR, MANAGER у пользователя IVAN                        
REVOKE DIRECTOR, MANAGER FROM USER IVAN;


-- Отзыв умолчательной роли MANAGER у пользователя FEDOR                        
REVOKE DEFAULT MANAGER FROM USER FEDOR;

-- Отзыв роли MANAGER и права назначать её другим пользователям
REVOKE ADMIN OPTION FOR MANAGER FROM USER ALEX;
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>
            </section>
            <section xml:id="security-priv-revoke-granted_by">
                <title>GRANTED BY</title>
                <indexterm>
                    <primary>REVOKE</primary>
                    <secondary>GRANTED BY</secondary>
                </indexterm>
                <para>При предоставлении прав в базе данных в качестве лица, предоставившего эти
                    права, обычно записывается текущий пользователь. Используя предложение GRANTED
                    BY можно предоставлять права от имени другого пользователя. При использовании
                    оператора REVOKE после GRANTED BY права будут удалены только в том случае, если
                    они были зарегистрированы от удаляющего пользователя. Для облегчения миграции из
                    некоторых других реляционных СУБД нестандартное предложение AS поддерживается
                    как синоним оператора GRANTED BY. </para>
                <para> Предложение GRANTED BY может использовать: <itemizedlist spacing="compact">
                        <listitem>
                            <para>Владелец базы данных;</para>
                        </listitem>
                        <listitem>
                            <para>SYSDBA;</para>
                        </listitem>
                        <listitem>
                            <para>Любой пользователь, имеющий права на роль RDB$ADMIN и указавший её
                                при соединении с базой данных;</para>
                        </listitem>
                        <listitem>
                            <para>При использовании флага AUTO ADMIN MAPPING — любой администратор
                                операционной системы Windows (при условии использования сервером
                                доверенной авторизации — trusted authentication), даже без указания
                                роли.</para>
                        </listitem>
                    </itemizedlist></para>
                <para>Даже владелец роли не может использовать GRANTED BY, если он не находится в
                    вышеупомянутом списке.</para>
                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Отзыв привилегий на таблицу с использованием GRANTED BY</title>
                            <para>
                                <programlisting language="sql">
-- отзыв привилегии SELECT у пользователя IVAN,
-- которая была выдана пользователем ALEX
REVOKE SELECT ON TABLE EMPLOYEE 
FROM USER IVAN GRANTED BY ALEX;
                </programlisting>
                            </para>
                        </example>
                    </para>
                </formalpara>
            </section>
            <section xml:id="security-priv-revoke-all_on_all">
                <title>REVOKE ALL ON ALL</title>
                <indexterm>
                    <primary>REVOKE</primary>
                    <secondary>ALL ON ALL</secondary>
                </indexterm>
                <para>Если после ключевого слова REVOKE указано предложение ALL ON ALL, то это
                    позволяет отменить все привилегии (включая роли) на всех объектах от одного или
                    более пользователей и/или ролей. Это быстрый способ &quot;очистить&quot;
                    (отобрать) права, когда пользователю должен быть заблокирован доступ к базе
                    данных.</para>
                <note>
                    <title>Примечания:</title>
                    <para>
                        <itemizedlist spacing="compact">
                            <listitem>
                                <para>Когда оператор REVOKE ALL ON ALL вызывается привилегированным
                                    пользователем (владельцем базы данных, SYSDBA или любым
                                    пользователем, у которого CURRENT_ROLE — RDB$ADMIN), удаляются
                                    все права независимо от того, кто их предоставил. В противном
                                    случае удаляются только права, предоставленные текущим
                                    пользователем;</para>
                            </listitem>
                            <listitem>
                                <para>Не поддерживается предложение GRANTED BY;</para>
                            </listitem>
                            <listitem>
                                <para>Этот оператор не удаляет флаг пользователя, давшего права на
                                    хранимые процедуры, триггеры или представлений (права на такие
                                    объекты конечно удаляются).</para>
                            </listitem>
                        </itemizedlist>
                    </para>
                </note>

                <formalpara>
                    <title>Примеры:</title>

                    <para>
                        <example>
                            <title>Отзыв всех привилегий и ролей у пользователя</title>
                            <para>
                                <programlisting language="sql">
REVOKE ALL ON ALL FROM IVAN;
                </programlisting>
                                После выполнения этой команды у пользователя IVAN нет вообще никаких
                                прав. </para>
                        </example>
                    </para>
                </formalpara>

                <formalpara>
                    <title>См. также:</title>

                    <para>
                        <link linkend="security-priv-grant">GRANT</link>. </para>
                </formalpara>
            </section>
        </section>

        <section xml:id="security-sql_security">
            <title>Привилегии выполнения SQL кода</title>
            <indexterm>
                <primary>SQL SECURITY</primary>
            </indexterm>
            <para>Все объекты метаданных содержащие DML или PSQL код могут выполнятся в одном из
                следующих режимов:<itemizedlist spacing="compact">
                    <listitem>
                        <para>С привилегиями вызывающего пользователя;</para>
                    </listitem>
                    <listitem>
                        <para>С привилегиями определяющего пользователя (владельца объекта
                            метаданных).</para>
                    </listitem>
                </itemizedlist></para>
            <para>Исторически сложилось, что все PSQL модули по умолчанию выполняются с привилегиями
                вызывающего пользователя. Начиная с Firebird 4.0 появилась возможность указывать
                объектам метаданных с какими привилегиями они будут выполняться: вызывающего или
                определяющего пользователя. Для этого используется предложение <database>SQL
                    SECURITY</database>, которое можно указать для таблицы, триггера, процедуры,
                функции или пакета. Если выбрана опция INVOKER, то объект метаданных будет
                выполняться с привилегиями вызывающего пользователя. Если выбрана опция DEFINER, то
                объект метаданных будет выполняться с привилегиями определяющего пользователя
                (владельца). Эти привилегии будут дополнены привилегиями выданные самому PSQL модулю
                с помощью оператора GRANT.</para>
            <para>Привилегии выполнения, с которым по умолчанию создаётся любой PSQL модуль можно
                изменить с помощью оператора
                <programlisting>
ALTER DATABASE SET DEFAULT SQL SECURITY {DEFINER | INVOKER}
  </programlisting>
                Для сохранения обратной совместимости по умолчанию используется опция INVOKER. </para>
            <note>
                <title>Замечания:</title>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>Представления (VIEWs) всегда выполняются с привилегиями
                                определяющего пользователя (владельца);</para>
                        </listitem>
                        <listitem>
                            <para>По умолчанию триггеры наследуют привилегии выполнения которые были
                                указаны у таблицы. Привилегии выполнения могут быть переопределены в
                                самом триггере;</para>
                        </listitem>
                        <listitem>
                            <para>Процедуры и функции пакета всегда наследуют привилегии выполнения
                                указанный при определении пакета. Привилегии выполнения не могут
                                быть переопределены в самих процедурах и функция пакета;</para>
                        </listitem>
                        <listitem>
                            <para>Анонимные PSQL блоки (EXECUTE BLOCK) всегда выполняются с правами
                                вызывающего пользователя.</para>
                        </listitem>
                    </itemizedlist>
                </para>
            </note>
            <section xml:id="security-priv-context-examples">
                <title>Примеры</title>
                <example>
                    <title>Создание таблицы с привилегиями определяющего пользователя</title>
                    <para>В данном случае пользователю JOE достаточно только привилегии SELECT на
                        таблицу t. Если бы таблица была создана с привилегиями вызывающего
                        пользователя (INVOKER), то ещё потребовалось бы выдать привилегию EXECUTE
                        для таблицы на функцию f.</para>
                    <para>
                        <programlisting language="sql">
SET TERM ^;

CREATE FUNCTION f() RETURNS INT
AS
BEGIN
  RETURN 3;
END^

SET TERM ;^

CREATE TABLE t (
  i INTEGER, 
  c COMPUTED BY (i + f())
)
SQL SECURITY DEFINER;

INSERT INTO t VALUES (2);

GRANT SELECT ON TABLE t TO USER joe;

COMMIT;

CONNECT 'inet://localhost:test' USER joe PASSWORD 'pas';

SELECT * FROM t;       
                </programlisting>
                    </para>
                </example>
                <example>
                    <title>Создание процедуры с привилегиями определяющего пользователя</title>
                    <para>В данном случае пользователю JOE достаточно только привилегии EXECUTE на
                        процедуру p. Если бы процедура была создана с привилегиями вызывающего
                        пользователя (опция INVOKER), то ещё потребовалось бы выдать привилегию
                        INSERT для процедуры p на таблицу t.</para>
                    <para>
                        <programlisting language="sql">
CREATE TABLE t (i INTEGER);

SET TERM ^;

CREATE PROCEDURE p (i INTEGER)
SQL SECURITY DEFINER
AS
BEGIN
  INSERT INTO t VALUES (:i);
END^

SET TERM ;^

GRANT EXECUTE ON PROCEDURE p TO USER joe;

COMMIT;

CONNECT 'inet://localhost:test' USER joe PASSWORD 'pas';

EXECUTE PROCEDURE p(1);
                </programlisting>
                    </para>
                </example>
                <example>
                    <title>Создание функции с привилегиями определяющего пользователя</title>
                    <para>В данном случае пользователю JOE достаточно только привилегии EXECUTE на
                        функцию f. Если бы функция была создана с привилегиями вызывающего
                        пользователя (опция INVOKER), то ещё потребовалось бы выдать привилегию
                        SELECT для функции f на таблицу t.</para>
                    <para>
                        <programlisting language="sql">
CREATE TABLE t (i INTEGER PRIMARY KEY, j INTEGER);

INSERT INTO t(i, j) VALUES(1, 2);
INSERT INTO t(i, j) VALUES(2, 5);

COMMIT;

SET TERM ^;

CREATE FUNCTION f (i INTEGER)
SQL SECURITY DEFINER
AS
  DECLARE j INTEGER DEFAULT NULL;
BEGIN
  SELECT j
  FROM t
  WHERE i = :i
  INTO j;
  
  RETURN COALESCE(j, 0);
END^

SET TERM ;^

GRANT EXECUTE ON FUNCTION f TO USER joe;

COMMIT;

CONNECT 'inet://localhost:test' USER joe PASSWORD 'pas';

SELECT f(1) AS j FROM RDB$DATABASE;
                </programlisting>
                    </para>
                </example>
                <example>
                    <title>Создание триггера с привилегиями определяющего пользователя</title>
                    <para>В данном случае пользователю JOE достаточно только привилегии INSERT на на
                        таблицу tr. Если бы триггер была создан с привилегиями вызывающего
                        пользователя (опция INVOKER), то ещё потребовалось бы выдать привилегию
                        INSERT для триггера tr_ins на таблицу t.</para>
                    <para>
                        <programlisting language="sql">
CREATE TABLE tr (i INTEGER);
CREATE TABLE t (i INTEGER);

SET TERM ^;

CREATE TRIGGER tr_ins FOR tr AFTER INSERT
SQL SECURITY DEFINER
AS
BEGIN
  INSERT INTO t(i) VALUES(NEW.i);
END^

SET TERM ;^

GRANT INSERT ON TABLE tr TO USER joe;

COMMIT;

CONNECT 'inet://localhost:test' USER joe PASSWORD 'pas';

INSERT INTO tr(i) VALUES(2);

COMMIT;
                </programlisting>
                    </para>
                    <para>Тот же самый результат можно получить указав SQL SECURITY DEFINER для
                        таблицы tr.
                        <programlisting language="sql">
CREATE TABLE tr (i INTEGER) SQL SECURITY DEFINER;
CREATE TABLE t (i INTEGER);

SET TERM ^;

CREATE TRIGGER tr_ins FOR tr AFTER INSERT
AS
BEGIN
  INSERT INTO t(i) VALUES(NEW.i);
END^

SET TERM ;^

GRANT INSERT ON TABLE tr TO USER joe;

COMMIT;

CONNECT 'inet://localhost:test' USER joe PASSWORD 'pas';

INSERT INTO tr(i) VALUES(2);

COMMIT;
                </programlisting>
                    </para>
                </example>
                <example>
                    <title>Удаление привилегий выполнения у триггера</title>
                    <para>Если триггеру явно установлена опция SQL SECURITY, то для того чтобы
                        наследовать привилегии выполнения у таблицы, необходимо выполнить следующий
                        оператор.
                        <programlisting language="sql">
ALTER TRIGGER tr_ins DROP SQL SECURITY;
                            </programlisting>
                    </para>
                </example>
                <example>
                    <title>Создание пакета с привилегиями определяющего пользователя</title>
                    <para>В данном случае пользователю JOE достаточно только привилегии EXECUTE на
                        пакет pk. Если бы пакет была создана с привилегиями вызывающего пользователя
                        (опция INVOKER), то ещё потребовалось бы выдать привилегию INSERT для пакета
                        pk на таблицу t.</para>
                    <para>
                        <programlisting language="sql">
CREATE TABLE t (i INTEGER);

SET TERM ^;

CREATE PACKAGE pk
SQL SECURITY DEFINER
AS
BEGIN
  FUNCTION f(i INTEGER) RETURNS INT;
END^

CREATE PACKAGE BODY pk
AS
BEGIN
  FUNCTION f(i INTEGER) RETURNS INT
  AS
  BEGIN
    INSERT INTO t VALUES (:i);
    RETURN i + 1;
  END
END^

SET TERM ;^

GRANT EXECUTE ON PACKAGE pk TO USER joe;

COMMIT;

CONNECT 'inet://localhost:test' USER joe PASSWORD 'pas';

SELECT pk.f(3) FROM rdb$database;
                </programlisting>
                    </para>
                </example>
                <example>
                    <title>Изменение привилегий выполнения по умолчанию</title>
                    <para>После выполнения данного оператора PSQL модули по умолчанию будут
                        создаваться с опцией SQL SECURITY DEFINER</para>
                    <para>
                        <programlisting language="sql">
ALTER DATABASE SET DEFAULT SQL SECURITY DEFINER;
                </programlisting>
                    </para>
                </example>
            </section>
        </section>

    </section>

    <section xml:id="security-crypt">
        <info>
            <title>Шифрование базы данных</title>
            <keywordset>
                <keyword>ENCRYPT</keyword>
                <keyword>DECRYPT</keyword>
            </keywordset>
        </info>
        <para>В Firebird существует возможность зашифровать данные хранимые в базе данных. Не весь
            файл базы данных шифруется: только страницы данных, индексов и blob. </para>
        <para>Для того чтобы сделать шифрование базы данных возможным необходимо получить или
            написать плагин шифрования базы данных.</para>
        <note>
            <para>Пример плагина шифрования в examples/dbcrypt не производит реального шифрования,
                это просто пример того, как можно написать этот плагин.</para>
        </note>
        <para>Основная проблема с шифрованием базы данных состоит в том, как хранить секретный ключ.
            Firebird предоставляет помощника для передачи этого ключа от клиента, но это вовсе не
            означает, что хранение ключей на клиенте является лучшим способом: это не более чем одна
            возможных альтернатив. Хранение ключей на том же диске что и база данных является очень
            плохим вариантом. </para>
        <para>Для эффективного разделения шифрования и доступа к ключу, плагин шифрования базы
            данных разделён на две части: само шифрование и держатель секретного ключа. Это может
            быть эффективным подходом, когда вы хотите использовать некоторый хороший алгоритм
            шифрования, но у вас есть собственный секретный способ хранение ключей.</para>
        <para>После того как вы определитесь с плагином и ключом, вы можете включить процесс
            шифрования.</para>
        <formalpara>
            <title>Синтаксис:</title>

            <para><programlisting>
ALTER DATABASE ENCRYPT WITH <replaceable>plugin_name</replaceable> [KEY <replaceable>key_name</replaceable>]
                       </programlisting></para>
        </formalpara>
        <para>
            <table frame="all">
                <title>Параметры оператора ALTER DATABASE ENCRYPT</title>
                <?dbfo keep-together='auto'?>
                <tgroup cols="2">
                    <colspec colname="c1" colnum="1" colwidth="0.8*" align="left"/>
                    <colspec colname="c2" colnum="2" colwidth="2.0*" align="justify"/>
                    <thead>
                        <row>
                            <entry align="center">Параметр</entry>
                            <entry align="center">Описание</entry>
                        </row>
                    </thead>
                    <tbody>
                        <row>
                            <entry><replaceable>plugin_name</replaceable></entry>
                            <entry>
                                <para>Имя плагина шифрования.</para>
                            </entry>
                        </row>
                        <row>
                            <entry><replaceable>key_name</replaceable></entry>
                            <entry>
                                <para>Имя ключа шифрования.</para>
                            </entry>
                        </row>
                    </tbody>
                </tgroup>
            </table>
        </para>

        <para>Шифрование начинается сразу после этого оператора и будет выполняться в фоновом
            режиме. Нормальная работа с базами данных не нарушается во время шифрования.</para>
        <tip>
            <para>Процесс шифрования может быть проконтролирован с помощью поля MON$CRYPT_PAGE в
                псевдо-таблице MON$DATABASE или смотреть страницу заголовка базы данных с помощью
                    <emphasis role="italic">gstat -e</emphasis>.</para>
            <para><emphasis role="italic">gstat –h</emphasis> также будет предоставлять ограниченную
                информацию о состоянии шифрования.</para>
            <para>Например, следующий запрос
                <programlisting language="sql">
select MON$CRYPT_PAGE * 100 / MON$PAGES from MON$DATABASE                  
                </programlisting>
                будет отображать процент завершения процесса шифрования. </para>
        </tip>
        <para>Необязательное предложение KEY позволяет передать имя ключа для плагина шифрования.
            Что делать с этим именем ключа решает плагин.</para>
        <para>Для дешифрования базы данных выполните:
            <programlisting language="sql">
ALTER DATABASE DECRYPT
            </programlisting>
        </para>
        <para>Для Linux пример плагина с именем <emphasis role="italic"
                >libDbCrypt_example.so</emphasis> можно найти в поддиректории <emphasis
                role="italic">/plugins/</emphasis>.</para>
    </section>
</chapter>
